<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag" style="width:100%">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html" style="width:100%">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css">
		</link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		</meta>
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>
	<p:growl id="msg"></p:growl>
	<h:form id="searchForm">
		<h:outputText value="输入菜名:"></h:outputText>
		<p:inputText id="orderNameInputLeftSum"
			value="#{costAnalysisController.foodName}">
		</p:inputText>
		<his:IME for="searchForm:orderNameInputLeftSum"
			fitcol="#{costAnalysisController.fitcolFood}" resultcol="1"
			lock="false" rawSQL="true" SQL="#{costAnalysisController.foodToSql}"
			SQLResult="#{costAnalysisController.displaycolFood}"
			multiresult="searchForm:orderNameInputLeftHiddenSum;0,searchForm:orderNameInputLeftSum;1" />
		<h:inputHidden id="orderNameInputLeftHiddenSum"
			value="#{costAnalysisController.foodId}"></h:inputHidden>
		<h:outputText value="输入时间:"></h:outputText>
		<p:calendar id="calendarStart" size="12"
			value="#{costAnalysisController.startDate}" pattern="yyyy-MM-dd"></p:calendar>
		<h:outputText value="至"></h:outputText>
		<p:calendar id="calendarEnd" size="12"
			value="#{costAnalysisController.endDate}" pattern="yyyy-MM-dd"></p:calendar>
		<p:commandButton styleClass="searchbtn" value=""
			update=":msg,:sumForm:sumDataTable"
			action="#{costAnalysisController.getCostAnalysisListByCondition}"></p:commandButton>
		<p:watermark value="调用输入法" for="orderNameInputLeftSum"></p:watermark>
		<p:watermark value="开始时间" for="calendarStart"></p:watermark>
		<p:watermark value="截止时间" for="calendarEnd"></p:watermark>
	</h:form>
	<h:form id="sumForm">
		<p:dataTable id="sumDataTable" emptyMessage="没有找到记录！" rows="13"
			paginator="true" paginatorPosition="bottom"
			paginatorAlwaysVisible="false"
			value="#{costAnalysisController.extendForCostAnalysisList}"
			paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
			var="analysisList" rowKey="#{analysisList.foodMenuId}"
			rowStyleClass="#{analysisList.greensQty  gt  analysisList.storageQty ? 'comparecss':null}">
			<p:column headerText="配料名称">
				<h:outputText value="#{analysisList.greensName}"></h:outputText>
			</p:column>
			<p:column headerText="配料数量">
				<h:outputText value="#{analysisList.greensQty}"></h:outputText>
			</p:column>
			<p:column headerText="配料单位">
				<h:outputText value="#{analysisList.qtyUnit}"></h:outputText>
			</p:column>
			<p:column headerText="库存量">
				<h:outputText value="#{analysisList.storageQty}"></h:outputText>
			</p:column>
			<p:column headerText="需要采购数">
				<h:outputText value="#{analysisList.purchaseQty}"></h:outputText>
			</p:column>
		</p:dataTable>
		<div align="center">
			<p:commandButton value="提取" styleClass="commonbtn"
				action="#{costAnalysisController.drawCostAnalysisList}"
				update=":drawForm,:msg" oncomplete="afterDraw(xhr, status, args)">
			</p:commandButton>
		</div>
	</h:form>
	<p:dialog id="drawDiaslog" widgetVar="drawDialog" appendToBody="ture"
		header="采购单" modal="true" position="center">
		<h:form id="drawForm">
			<p:dataTable id="drawList" widgetVar="drawTable" var="costAnalysis"
				value="#{costAnalysisController.drawCostAnalysisList}"
				rowKey="#{costAnalysis.foodMenuId}" emptyMessage="当前无内容"
				selectionMode="single" paginatorAlwaysVisible="false"
				selection="#{costAnalysisController.selectCostAnalysis}" rows="10"
				paginatorPosition="bottom"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
				paginator="true">
				<p:ajax event="rowSelect"
					listener="#{costAnalysisController.onCostAnalysisSelect}"
					update=":msg,:drawForm" />
				<p:ajax event="rowUnselect"
					listener="#{costAnalysisController.onCostAnalysisUnselect}"
					update=":msg,:drawForm" />

				<p:column id="greensName">
					<f:facet name="header">
						<h:outputText value="配料名称"></h:outputText>
					</f:facet>
					<h:outputText value="#{costAnalysis.greensName}"></h:outputText>
				</p:column>
				<p:column id="purchaseQty">
					<f:facet name="header">
						<h:outputText value="采购数量"></h:outputText>
					</f:facet>
					<h:outputText value="#{costAnalysis.purchaseQty}"></h:outputText>
				</p:column>
				<p:column id="qtyUnit">
					<f:facet name="header">
						<h:outputText value="单位"></h:outputText>
					</f:facet>
					<h:outputText value="#{costAnalysis.qtyUnit}"></h:outputText>
				</p:column>
				<p:column id="price">
					<f:facet name="header">
						<h:outputText value="参考价格"></h:outputText>
					</f:facet>
					<h:outputText value="#{costAnalysis.price}"></h:outputText>
				</p:column>
			</p:dataTable>
			<div align="center">
				<p:commandButton value="修改" styleClass="commonbtn"
					process="@this,drawForm" ajax="true"
					actionListener="#{costAnalysisController.checkSelectData}"
					oncomplete="beforeEdit(xhr, status, args)" update=":editForm,:msg">
				</p:commandButton>
				<p:commandButton value="导出" styleClass="commonbtn" update=":msg"
					ajax="false">
					<p:dataExporter type="xls" target=":drawForm:drawList"
						fileName="purchaseOrders" />
				</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
	<p:dialog id="editDialog" widgetVar="editDialog" appendToBody="ture"
		header="修改采购单" modal="true" position="center">
		<h:form id="editForm">
			<table style="width: 200px">
				<tr>
					<td class="hengbiaogeHeader1 redfont" width="100"><h:outputText
							value="配料名称:" style="text-align:right" /></td>
					<td><p:inputText id="greensName" required="true"
							requiredMessage="请输入配料名称！"
							value="#{costAnalysisController.selectCostAnalysis.greensName}">
						</p:inputText></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1 redfont" width="100"><h:outputText
							value="采购数量:" style="text-align:right" /></td>
					<td><p:inputText id="purchaseQty"
							converterMessage="请输入一个正确的数量！" required="true"
							requiredMessage="请输入采购数量！"
							value="#{costAnalysisController.selectCostAnalysis.purchaseQty}">
							<f:convertNumber pattern="#,###.00" type="number"></f:convertNumber>
						</p:inputText></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1 redfont" width="100"><h:outputText
							value="单位:" style="text-align:right" /></td>
					<td><p:inputText id="qtyUnit" required="true"
							requiredMessage="请输入单位！"
							value="#{costAnalysisController.selectCostAnalysis.qtyUnit}">
						</p:inputText></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1 redfont" width="100"><h:outputText
							value="参考价格:" style="text-align:right" /></td>
					<td><p:inputText id="price" converterMessage="请输入一个正确的价格！"
							value="#{costAnalysisController.selectCostAnalysis.price}">
							<f:convertNumber pattern="#,###.00" type="number"></f:convertNumber>
						</p:inputText></td>
				</tr>
			</table>
			<div align="center">
				<p:commandButton value="" styleClass="submitbtn"
					action="#{costAnalysisController.updateCostAnalysisList}"
					oncomplete="afterEdit(xhr, status, args)" update=":msg,:drawForm">
				</p:commandButton>
				<p:commandButton value="" styleClass="cancelbtn" type="button"
					onclick="editDialog.hide()">
				</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
	<script type="text/javascript">
		function afterDraw(xhr, status, args) {
			if (args.validate) {
				drawDialog.show();
			}
		}
		function beforeEdit(xhr, status, args) {
			if (args.validate) {
				editDialog.show();
			}
		}
		function afterEdit(xhr, status, args) {
			if (args.validate) {
				editDialog.hide();
			}
		}
	</script>
</f:view>
</html>