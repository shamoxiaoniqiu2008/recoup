<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css" ></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	    <script type="text/javascript" src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
	<script type="text/javascript" src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	<h:outputScript library="javax.faces" name="jsf.js" target="head" />
	</h:head>
	<h:body>
	<p:growl id="messages"></p:growl>
	<h:form id="headForm">
		<h:panelGrid columns="15">
			<h:outputText value="&nbsp;&nbsp;申请时间:" style="width:80" />
			<p:calendar id="startDate" pattern="yyyy-MM-dd" size="15"
				value="#{sumRepairCountController.startDate}" />
			<h:outputText value="至:" style="width:80" />
			<p:calendar id="endDate" pattern="yyyy-MM-dd" size="15"
				value="#{sumRepairCountController.endDate}" />
			<h:panelGroup>
				<h:outputLabel value="大厦:" for="headForm:buildNameText"  />
				<p:inputText id="buildNameText" style="width:145px;"> 
					<p:ajax  event="blur" listener="#{sumRepairCountController.changeFloorAndRoomSql}" update=":headForm"
					process="@this,headForm:buildIdHd" />
				</p:inputText>
				<his:IME for="headForm:buildNameText"
				 	fitcol="buildName" resultcol="1" rawSQL="true"
				 	SQL="#{sumRepairCountController.buildSQL}"
					SQLResult="大厦ID:0:hide,大厦:1"
					multiresult="headForm:buildIdHd;0">
				</his:IME>
				<h:inputHidden id="buildIdHd" value="#{sumRepairCountController.buildId}" />
			</h:panelGroup>	
			
			<h:panelGroup>
				<h:outputLabel value="楼层:" for="headForm:floorNameText"  />
				<p:inputText id="floorNameText" style="width:145px;"> 
					<p:ajax  event="blur" listener="#{sumRepairCountController.changeRoomSql}" update=":headForm"
					process="@this,headForm:floorIdHd" />
				</p:inputText>
				<his:IME for="headForm:floorNameText"
				 	fitcol="floorName" resultcol="1" rawSQL="true"
				 	SQL="#{sumRepairCountController.floorSQL}"
					SQLResult="楼层ID:0:hide,楼层:1,大厦:2"
					multiresult="headForm:floorIdHd;0">
				 </his:IME>
				 <h:inputHidden id="floorIdHd" value="#{sumRepairCountController.floorId}" />
			</h:panelGroup>
			
			<h:panelGroup>
				<h:outputLabel value="房间:" for="headForm:roomNameText"  />
				 <p:inputText id="roomNameText" style="width:145px;" /> 
				 <his:IME for="headForm:roomNameText"
				 	fitcol="roomName" resultcol="1" rawSQL="true"
				 	SQL="#{sumRepairCountController.roomSQL}"
					SQLResult="房间ID:0:hide,房间:1,楼层:2,大厦:3"
					multiresult="headForm:roomIdHd;0">
				 </his:IME>
				 <h:inputHidden id="roomIdHd" value="#{sumRepairCountController.roomId}" />
			</h:panelGroup>			
			 
			<p:commandButton id="searchButton"
				action="#{sumRepairCountController.selectRepairCountRecords}"
				styleClass="searchbtn" value=""
				update=":dataTableForm:repairCountTable,:messages" />
			<p:commandButton oncomplete="clearSelectForm()" styleClass="blankbtn" value="" 
						action="#{sumRepairCountController.clearSelectForm}" update=":headForm,:messages"/>
		</h:panelGrid>
	</h:form>
	<h:form id="dataTableForm">
			<h:panelGrid id="repairCountRecord"  style="width:100%">
				<p:dataTable cellspacing="8" rows="10" style="width:100%"
					id="repairCountTable" rowIndexVar="row"
					value="#{sumRepairCountController.repairRecords}"
					var="record" rowKey="#{record.id}"  emptyMessage="没有相应记录"
					paginator="true" paginatorPosition="bottom"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
					>
					<p:column headerText="大厦">
						<h:outputText value="#{record.buildName}" />
					</p:column>
					<p:column headerText="楼层">
						<h:outputText value="#{record.floorName}" />
					</p:column>
					<p:column headerText="房间">
						<h:outputText value="#{record.roomName}" />
					</p:column>
					<p:column headerText="维修类型">
						<h:outputText value="个人维修" rendered="#{record.repairType == 1}" />
						<h:outputText value="排查维修" rendered="#{record.repairType == 2}" />
					</p:column>
					<p:column headerText="次数">
						<h:outputText value="#{record.repairCount}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
	</h:form>
	<script type="text/javascript">
		//清空 selectForm
		function clearSelectForm(){
			document.getElementById("headForm:startDate").value="";
			document.getElementById("headForm:endDate").value="";
			document.getElementById("headForm:buildNameText").value="";
			document.getElementById("headForm:floorNameText").value="";
			document.getElementById("headForm:roomNameText").value="";
			
			return true;
		}
	</script>
	</h:body>
</f:view>
</html>