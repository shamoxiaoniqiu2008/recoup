<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css" ></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	    <script type="text/javascript" src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
	<script type="text/javascript" src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	<h:outputScript library="javax.faces" name="jsf.js" target="head" />
	</h:head>
	<h:body>
	<p:growl id="messages"></p:growl>
	<h:form id="headForm">
		<h:panelGrid columns="15">
			<h:outputText value="&nbsp;&nbsp;调房时间:" style="width:80" />
			<p:calendar id="startDate" pattern="yyyy-MM-dd" size="15"
				value="#{changeRoomController.startDate}" />
			<h:outputText value="至:" style="width:80" />
			<p:calendar id="endDate" pattern="yyyy-MM-dd" size="15"
				value="#{changeRoomController.endDate}" />
			<h:outputLabel value="老人姓名:" for="headForm:nameText"  />
				<h:panelGroup>
					<p:inputText id="nameText" style="width:120px" />
					<his:IME for="headForm:nameText"
						fitcol="inputCode" resultcol="0" lock="true"
						rawSQL="true"
						SQL="#{changeRoomController.olderNameSql}"
						SQLResult="老人姓名:0,大厦:1,楼层:2,房间:3,床位:4,老人Id:5:hide,输入码:6"
						multiresult="headForm:olderIdHd;5" />
					<h:inputHidden id="olderIdHd" value="#{changeRoomController.olderId}" />
				</h:panelGroup>
			<p:commandButton id="searchButton"
				action="#{changeRoomController.selectChangeroomApplicationRecords}"
				styleClass="searchbtn" value=""
				update=":dataTableForm:changeRoomTable,:maintainForm,:messages" />
			<p:commandButton oncomplete="clearSelectForm()" styleClass="blankbtn" value="" 
						action="#{changeRoomController.clearSelectForm}" update=":headForm,:messages"/>
		</h:panelGrid>
	</h:form>
	<h:form id="dataTableForm">
			<h:panelGrid id="changeRoomRecord"  style="width:100%">
				<p:dataTable cellspacing="8" rows="10" style="width:100%"
					id="changeRoomTable" rowIndexVar="row"
					value="#{changeRoomController.records}"
					var="record" rowKey="#{record.id}" selectionMode="multiple" emptyMessage="没有相应记录"
					selection="#{changeRoomController.selectedRows}"
					paginator="true" paginatorPosition="bottom"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
					>
					<p:ajax event="rowSelect" listener="#{changeRoomController.selectRecord}" update=":dataTableForm,:maintainForm"/>
					<p:ajax event="rowUnselect" listener="#{changeRoomController.unSelectRecord}" update=":dataTableForm,:maintainForm"/>
					<p:column headerText="姓名">
						<h:outputText value="#{record.olderName}" />
					</p:column>
					<p:column headerText="旧大厦">
						<h:outputText value="#{record.oldBuildName}" />
					</p:column>
					<p:column headerText="旧楼层">
						<h:outputText value="#{record.oldFloorName}" />
					</p:column>
					<p:column headerText="旧房间">
						<h:outputText value="#{record.oldRoomName}" />
					</p:column>
					<p:column headerText="旧床位">
						<h:outputText value="#{record.oldBedName}" />
					</p:column>
					<p:column headerText="新大厦">
						<h:outputText value="#{record.newBuildName}" />
					</p:column>
					<p:column headerText="新楼层">
						<h:outputText value="#{record.newFloorName}" />
					</p:column>
					<p:column headerText="新房间">
						<h:outputText value="#{record.newRoomName}" />
					</p:column>
					<p:column headerText="新床位">
						<h:outputText value="#{record.newBedName}" />
					</p:column>
					<p:column headerText="调房时间">
						<h:outputText value="#{record.changeroomTime}" >
							<f:convertDateTime pattern="yyyy-MM-dd HH:mm" timeZone="GMT+8" />
						</h:outputText>	
					</p:column>
					<p:column headerText="搬家人">
						<h:outputText value="#{record.moverName}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
	</h:form>
	<h:form id="maintainForm">
		<div align="center">
			<p:commandButton styleClass="addbtn" value="" 
				action="#{changeRoomController.clearInsertForm}"
				oncomplete="insertRecordDialog.show()"
				update=":insertForm" />
			<p:commandButton styleClass="deletebtn" value="" disabled="#{changeRoomController.disDeleteAndSubmitButton}"
				onclick="confirmDialog.show()" type="button"/>
			<p:commandButton styleClass="modifybtn" value=""	disabled="#{changeRoomController.disUpdateButton}"
				action="#{changeRoomController.copyRecordUpdatedRow}" 
				oncomplete="handleUpdateInit(xhr, status, args)"
				update=":updateForm,:messages" />
		</div>
	</h:form>

	<p:dialog header="新增" widgetVar="insertRecordDialog"
		resizable="false"  appendTo="@(body)" position="center"
		modal="true">
		<h:form id="insertForm">
			<table class="hengbiaoge" width="100%"
				id="insertTable">
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="老人姓名:" for="nameText"  styleClass="redfont" /></td>
					<td class="hengbiaogedata"><h:panelGroup>
						<p:inputText id="nameText" style="width:125px" required="true" requiredMessage="请输入老人姓名!"
							value="#{changeRoomController.insertedRow.olderName}" >
							<p:ajax event="blur" listener="#{changeRoomController.fillField}"
							update=":insertForm" process="@this,olderIdHd" />
						</p:inputText>
						<his:IME for="insertForm:nameText"
							fitcol="inputCode" resultcol="0" lock="true"
							rawSQL="true"
							SQL="#{changeRoomController.olderNameSql}"
							SQLResult="老人姓名:0,大厦:1,楼层:2,房间:3,床位:4,老人Id:5:hide,输入码:6"
							multiresult="insertForm:buildingText;1,insertForm:roomText;3,insertForm:bedNoText;4,insertForm:olderIdHd;5" />
						<h:inputHidden id="olderIdHd" value="#{changeRoomController.insertedRow.olderId}" />
					</h:panelGroup></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧床位号:" for="oldBedText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldBedText"  style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.oldBedName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧房间:" for="oldRoomText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldRoomText"  style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.oldRoomName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧楼层号:" for="oldFloorText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldFloorText"  style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.oldFloorName}" /></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧大厦:" for="oldBuildingText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldBuildingText" style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.oldBuildName}" /></td>
				</tr>
				
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="新床位号:" for="newBedText" styleClass="redfont" /></td>
					<td class="hengbiaogedata"><h:panelGroup>
						<p:inputText id="newBedText"  style="width:125px"  required="true" requiredMessage="请输入新的床位号!"
							value="#{changeRoomController.insertedRow.newBedName}" >
							<p:ajax event="blur" listener="#{changeRoomController.fillBedField}"
							update=":insertForm" process="@this,newbedIdHd" />
						</p:inputText> 
						<his:IME for="insertForm:newBedText"
						 	fitcol="newBedName" resultcol="1" rawSQL="true"
						 	SQL="#{changeRoomController.bedNameSql}"
							SQLResult="床位ID:0:hide,床位:1,房间:3,楼层:5,大厦:7"
							multiresult="insertForm:newbedIdHd;0,insertForm:newRoomText;2,insertForm:newFloorText;3,insertForm:newBuildingText;4" >
						 </his:IME>
						<h:inputHidden id="newbedIdHd" value="#{changeRoomController.insertedRow.newbedId}" /></h:panelGroup>
					</td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="新房间:" for="newRoomText" /></td>
					<td class="hengbiaogedata"><p:inputText id="newRoomText"  style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.newRoomName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="新楼层号:" for="newFloorText" /></td>
					<td class="hengbiaogedata"><p:inputText id="newFloorText"  style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.newFloorName}" /></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="新大厦:" for="newBuildingText" /></td>
					<td class="hengbiaogedata"><p:inputText id="newBuildingText" style="width:125px" readonly="true"
							value="#{changeRoomController.insertedRow.newBuildName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="搬家人姓名:" for="moverNameText" styleClass="redfont"/></td>
					<td class="hengbiaogedata">
					<h:panelGroup>
						<p:inputText id="moverNameText" style="width:125px" required="true" 
						value="#{changeRoomController.insertedRow.moverName}"
						requiredMessage="请输入搬家人姓名!" />
						<his:IME for="insertForm:moverNameText"
							fitcol="inputCode" resultcol="0" lock="true"
							rawSQL="true"
							SQL="#{changeRoomController.employeeNameSql}"
							SQLResult="搬家人:0,部门:1,输入码:2,搬家人Id:3:hide"
							multiresult="insertForm:moverIdHd;3"/>
						<h:inputHidden id="moverIdHd" value="#{changeRoomController.insertedRow.moverId}" />
					</h:panelGroup>
					</td>
				</tr>
			</table>
			<div style="width: 100%; text-align: center;">
			<p:commandButton styleClass="submitbtn" value="" 
			action="#{changeRoomController.insertChangeroomApplicationRecord}" 
			update=":insertForm,:dataTableForm,:messages,:maintainForm"
			oncomplete="handleInsertComplete(xhr, status, args)"
			/>
			<p:commandButton type="reset" styleClass="cancelbtn" value=""
				onclick="insertRecordDialog.hide()">
			</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
	<p:dialog header="修改" widgetVar="updateRecordDialog"
		resizable="false"  appendTo="@(body)" position="center"
		modal="true">
		<h:form id="updateForm">
			<table class="hengbiaoge" width="100%"
				id="updateTable">
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="老人姓名:" for="nameText"  styleClass="redfont" /></td>
					<td class="hengbiaogedata"><p:inputText id="nameText" style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.olderName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧床位号:" for="oldBedText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldBedText"  style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.oldBedName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧房间:" for="oldRoomText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldRoomText"  style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.oldRoomName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧楼层号:" for="oldFloorText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldFloorText"  style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.oldFloorName}" /></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="旧大厦:" for="oldBuildingText" /></td>
					<td class="hengbiaogedata"><p:inputText id="oldBuildingText" style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.oldBuildName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="新床位号:" for="newBedText" styleClass="redfont" /></td>
					<td class="hengbiaogedata"><h:panelGroup>
						<p:inputText id="newBedText"  style="width:125px"  required="true" requiredMessage="请输入新的床位号!"
							value="#{changeRoomController.updatedRow.newBedName}" >
							<p:ajax event="blur" listener="#{changeRoomController.fillUpdateNewBedField}"
							update=":updateForm" process="@this,newbedIdHd" />
						</p:inputText> 
						<his:IME for="updateForm:newBedText"
						 	fitcol="newBedName" resultcol="1" rawSQL="true"
						 	SQL="#{changeRoomController.bedNameSql}"
							SQLResult="床位ID:0:hide,床位:1,房间:3,楼层:5,大厦:7"
							multiresult="updateForm:newbedIdHd;0,updateForm:newRoomText;2,updateForm:newFloorText;3,updateForm:newBuildingText;4" >
						 </his:IME>
						<h:inputHidden id="newbedIdHd" value="#{changeRoomController.updatedRow.newbedId}" /></h:panelGroup>
					</td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="新房间:" for="newRoomText" /></td>
					<td class="hengbiaogedata"><p:inputText id="newRoomText"  style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.newRoomName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="新楼层号:" for="newFloorText" /></td>
					<td class="hengbiaogedata"><p:inputText id="newFloorText"  style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.newFloorName}" /></td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="新大厦:" for="newBuildingText" /></td>
					<td class="hengbiaogedata"><p:inputText id="newBuildingText" style="width:125px" readonly="true"
							value="#{changeRoomController.updatedRow.newBuildName}" /></td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="搬家人姓名:" for="moverNameText" styleClass="redfont"/></td>
					<td class="hengbiaogedata">
					<h:panelGroup>
						<p:inputText id="moverNameText" style="width:125px" required="true" 
						value="#{changeRoomController.updatedRow.moverName}"
						requiredMessage="请输入搬家人姓名!" />
						<his:IME for="updateForm:moverNameText"
							fitcol="inputCode" resultcol="0" lock="true"
							rawSQL="true"
							SQL="#{changeRoomController.employeeNameSql}"
							SQLResult="搬家人:0,部门:1,输入码:2,搬家人Id:3:hide"
							multiresult="updateForm:moverIdHd;3"/>
						<h:inputHidden id="moverIdHd" value="#{changeRoomController.updatedRow.moverId}" />
					</h:panelGroup>
					</td>
				</tr>
			</table>
			<div style="width: 100%; text-align: center;">
			<p:commandButton styleClass="submitbtn" value="" 
			action="#{changeRoomController.updateChangeroomApplicationRecord}" 
			oncomplete="handleUpdateComplete(xhr, status, args)"
			update=":updateForm,:dataTableForm,:messages,:maintainForm"/>
			<p:commandButton type="reset" styleClass="cancelbtn" value=""
				onclick="updateRecordDialog.hide()">
			</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
	<p:confirmDialog modal="true" appendTo="@(body)"
		widgetVar="confirmDialog" message="确定要删除该申请记录？">
		<h:form>
			<p:commandButton styleClass="commonbtn"  value="确定"
				action="#{changeRoomController.deleteChangeroomApplicationRecord}"
				update=":dataTableForm,:maintainForm,:messages"
				oncomplete="confirmDialog.hide();">
			</p:commandButton>
			<p:commandButton styleClass="commonbtn"  value="取消" type="reset"
				onclick="confirmDialog.hide();"></p:commandButton>
		</h:form>
	</p:confirmDialog>
	
	<script type="text/javascript">
		//清空 selectForm
		function clearSelectForm(){
			document.getElementById("headForm:startDate").value="";
			document.getElementById("headForm:endDate").value="";
			return true;
		}
		function handleInsertComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				insertRecordDialog.hide();
            }	
		}
		function handleDeleteComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				confirmDialog.show();
            }	
		}
		function handleUpdateInit(xhr, status, args){
			updateRecordDialog.show();
		}
		function handleUpdateComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				updateRecordDialog.hide();
            }	
		}
		
	</script>
	</h:body>
</f:view>
</html>