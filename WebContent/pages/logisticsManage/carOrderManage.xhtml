<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:his="http://centling.his.net/histag"
	xmlns:p="http://primefaces.org/ui">
<f:view contentType="text/html">

	<style>
.ui-panel .ui-panel-content {
	padding: 0em !important;
}
</style>

	<h:head>


		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>

		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/common.js?ver=#{projectConfig.ver}" />
	</h:head>

	<h:body>
		<p:growl id="message" widgetVar="message"></p:growl>
		<h:form id="searchForm">
			<table>
				<tr>
					<td class="leftcell">车牌号:</td>
					<td><p:inputText id="carNumberText" style="width:100px;"
							value="#{carOrderController.carNumberName}">
						</p:inputText> <his:IME for="searchForm:carNumberText" fitcol="plate_number"
							resultcol="1" rawSQL="true" SQL="#{carOrderController.carSQL}"
							SQLResult="车辆ID:0:hide,车牌号:1,车辆类型:2,联系人:10"
							multiresult="searchForm:carNumberHd;0">
						</his:IME> <h:inputHidden id="carNumberHd"
							value="#{carOrderController.carNumberId}" /></td>

					<td class="leftcell">老人姓名:</td>
					<td><p:inputText id="olderName" style="width:100px;"
							value="#{carOrderController.olderName}">
						</p:inputText> <his:IME for="searchForm:olderName" fitcol="inputCode,oldName"
							resultcol="1" lock="true" rawSQL="true"
							SQL="#{carOrderController.olderNameSql}"
							SQLResult="编号:6:hide,姓名:0,性别:5,大厦:1,楼层:2,房间:3,床位:4"
							multiresult="searchForm:olderIdHd;0" /> <h:inputHidden
							id="olderIdHd" value="#{carOrderController.olderId}" /></td>
					<td class="leftcell">实际出发时间:</td>
					<td><p:calendar value="#{carOrderController.starDate}"
							size="9" locale="zh_CN" pattern="yyyy-MM-dd"></p:calendar></td>
					<td class="leftcell">至:</td>
					<td><p:calendar value="#{carOrderController.endDate}"
							pattern="yyyy-MM-dd" size="9"></p:calendar></td>
					<td class="leftcell">出车状态</td>
					<td><h:selectOneMenu value="#{carOrderController.carStatus}"
							id="carstatus"
							class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
							<f:selectItem itemLabel="所有" itemValue="4" />
							<f:selectItem itemLabel="未出车" itemValue="1" />
							<f:selectItem itemLabel="出车中" itemValue="2" />
							<f:selectItem itemLabel="已返回" itemValue="3" />
						</h:selectOneMenu></td>
					<td class="leftcell">登记状态</td>
					<td><h:selectOneMenu value="#{carOrderController.isRegister}"
							id="isRegister"
							class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
							<f:selectItem itemLabel="所有" itemValue="3" />
							<f:selectItem itemLabel="已登记" itemValue="1" />
							<f:selectItem itemLabel="未登记" itemValue="2" />
						</h:selectOneMenu></td>
					<td class="leftcell"><p:commandButton styleClass="searchbtn"
							value="" process="@this,searchForm"
							actionListener="#{carOrderController.selectAllOrcerList}"
							update=":listForm,:maintainForm,:message" /></td>
					<td class="leftcell"><p:commandButton styleClass="blankbtn"
							value="" process="@this"
							actionListener="#{carOrderController.clearSearchForm}"
							update=":searchForm,:message" /></td>
				</tr>
			</table>
		</h:form>
		<h:form id="listForm" style="width:100%">
			<p:dataTable id="listTable" var="result" rowKey="#{result.id}"
				value="#{carOrderController.manageList}"
				selection="#{carOrderController.selectedOrder}"
				selectionMode="single" cellspacing="8" rows="10"
				row="#{carManageController.setEnableFlag}" rowIndexVar="row"
				emptyMessage="#{pageConfig.noRow}" paginatorAlwaysVisible="false"
				paginator="true" paginatorPosition="bottom"
				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
				<p:ajax event="rowSelect"
					listener="#{carOrderController.setEnableFlag}"
					update=":maintainForm,:message" />
				<p:ajax event="rowUnselect"
					listener="#{carOrderController.setUnableFlag}"
					update=":maintainForm,:message" />

				<p:column headerText="车牌号" styleClass="width50">  
		            #{result.vehicleNumber}   
		        </p:column>

				<p:column headerText="预约老人" width="60">  
		            #{result.olderName}   
		        </p:column>

				<p:column headerText="预计出发时间" width="120"
					rendered="#{carOrderController.isShow}">
					<h:outputText value="#{result.expectGotime}">
						<f:convertDateTime pattern="yyyy-MM-dd H:mm" />
					</h:outputText>
				</p:column>

				<p:column headerText="预计返回时间" width="120"
					rendered="#{carOrderController.isShow}">
					<h:outputText value="#{result.expectBacktime}">
						<f:convertDateTime pattern="yyyy-MM-dd H:mm" />
					</h:outputText>
				</p:column>

				<p:column headerText="预计里程">  
		            #{result.expectDistance}   
		        </p:column>
				<p:column headerText="事由">
					<p:outputPanel style="height:40">
		        	 	#{result.matterDetail}  
		        	</p:outputPanel>
				</p:column>
				<p:column headerText="是否登记" width="60">
					<h:outputText value="已登记" rendered="#{result.registerFlag == 1}" />
					<h:outputText value="未登记" rendered="#{result.registerFlag == 2}" />
				</p:column>
				<p:column headerText="出车状态" width="60">
					<h:outputText value="未出车" rendered="#{result.vehicleState == 1}" />
					<h:outputText value="出车中" rendered="#{result.vehicleState == 2}" />
					<h:outputText value="已返回" rendered="#{result.vehicleState == 3}" />
				</p:column>
				<p:column headerText="实际出发时间" width="120"
					rendered="#{!carOrderController.isShow}">
					<h:outputText value="#{result.actualGotime}">
						<f:convertDateTime pattern="yyyy-MM-dd H:mm" />
					</h:outputText>
				</p:column>
				<p:column headerText="实际返回时间" width="120"
					rendered="#{!carOrderController.isShow}">
					<h:outputText value="#{result.actualBacktime}">
						<f:convertDateTime pattern="yyyy-MM-dd H:mm" />
					</h:outputText>
				</p:column>
				<p:column headerText="实际里程">  
		            #{result.actualDistance}   
		        </p:column>
				<p:column headerText="已录费">
					<h:outputText value="是" rendered="#{result.chargeFlag == 1}"></h:outputText>
					<h:outputText value="否" rendered="#{result.chargeFlag == 2}"></h:outputText>
				</p:column>
				<p:column headerText="确认人">
					<h:outputText value="#{result.ensureEmpName}"></h:outputText>
				</p:column>

			</p:dataTable>

		</h:form>
		<div align="center">
			<h:form id="maintainForm">
				<p:commandButton styleClass="commonbtn" value="出车检查"
					action="#{carOrderController.selectOutCatInfo}"
					oncomplete="afterCheckOutData(xhr,status,args)"
					disabled="#{!carOrderController.checkFlag}"
					update=":checkForm,:message" />
				<p:commandButton styleClass="commonbtn" value="出车计费"
					action="#{carOrderController.selectInCatInfo}"
					disabled="#{!carOrderController.feeFlag}"
					oncomplete="afterCheckInData(xhr,status,args)"
					update=":chargeForm,:message" />
				<p:commandButton styleClass="commonbtn" value="费用录入"
					action="#{carOrderController.checkBeHandledAndPayed}"
					oncomplete="showTag(xhr, status, args)"
					disabled="#{!(carOrderController.selectedOrder.vehicleState == 3 and carOrderController.selectedOrder.chargeFlag == 2 and carOrderController.selectedOrder.chargeFlag == 2) }"
					update=":listForm,:maintainForm,:message"></p:commandButton>
			</h:form>
		</div>
		<p:dialog header="出车检查" widgetVar="checkDialog" resizable="false"
			appendTo="@(body)" modal="true">
			<h:form id="checkForm">
				<table class="hengbiaoge">
					<tr>
						<td class="hengbiaogeHeader1"><label for="plateNumber">车牌号</label>
						</td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="plateNumber"
								value="#{carOrderController.selectCarInfo.plateNumber}"
								readonly="true">
							</p:inputText></td>
						<td class="hengbiaogeHeader1"><h:outputText class="redfont"
								value="当前公里数" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="currentKilometers" type="number" required="true"
								requiredMessage="请填写当前公里数！"
								value="#{carOrderController.selectCarInfo.currentKilometers}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label for="vehicleType">车辆类型</label>
						</td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="vehicleType" readonly="true"
								value="#{carOrderController.selectCarInfo.vehicleType}">
							</p:inputText></td>
						<td class="hengbiaogeHeader1"><h:outputText class="redfont"
								value="可行公里数" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="candriveKilometers" type="number" required="true"
								requiredMessage="请填写可行公里数！"
								value="#{carOrderController.selectCarInfo.candriveKilometers}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label for="holdPeoples">容纳人数</label>
						</td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="holdPeoples" readonly="true"
								value="#{carOrderController.selectCarInfo.holdPeoples}">
							</p:inputText></td>
						<td class="hengbiaogeHeader1"><h:outputText class="redfont"
								value="预计里程" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="expectDistance" type="number" required="true"
								requiredMessage="请填写预计里程！"
								value="#{carOrderController.expectDistance}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label for="contacter">联系人</label>
						</td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="contacter" readonly="true"
								value="#{carOrderController.contacter}">
							</p:inputText></td>
						<td class="hengbiaogeHeader1"><h:outputText class="redfont"
								value="实际出发时间" /></td>
						<td class="hengbiaogedata"><p:calendar id="actualGotime"
								pattern="yyyy-MM-dd HH:mm" stepMinute="30" required="true"
								size="20" requiredMessage="请填写实际出发时间!"
								mindate="#{carOrderController.currentDate}"
								value="#{carOrderController.actualGotime}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText value="剩余油量" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="remainFuel" type="number"
								value="#{carOrderController.selectCarInfo.remainFuel}">
							</p:inputText></td>
						<td class="hengbiaogeHeader1"><h:outputText value="备注" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="notes" readonly="true"
								value="#{carOrderController.selectCarInfo.note}">
							</p:inputText></td>
					</tr>
				</table>
				<div align="center">
					<p:commandButton styleClass="commonbtn" value="确定"
						action="#{carOrderController.ensureDrawOut}"
						oncomplete="afterEnsureDrawOut(xhr,status,args)"
						update=":listForm:listTable,:maintainForm,:message" />
					<p:commandButton onclick="checkDialog.hide()" type="button"
						styleClass="cancelbtn" value="" />
				</div>
			</h:form>
		</p:dialog>
		<p:dialog header="出车计费" widgetVar="chargeDialog" resizable="false"
			appendTo="@(body)" modal="true">
			<h:form id="chargeForm">
				<table class="hengbiaoge">
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="expectBacktime_input">实际返回时间</label></td>
						<td class="hengbiaogedata"><p:calendar id="expectBacktime"
								pattern="yyyy-MM-dd HH:mm" stepMinute="20" required="true"
								requiredMessage="请填写实际返回时间！"
								mindate="#{carOrderController.selectedOrder.actualGotime}"
								value="#{carOrderController.actualBacktime}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="actualDistance">实际里程</label></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								required="true" requiredMessage="请填写实际里程！" maxlength="10"
								id="actualDistance" type="number"
								value="#{carOrderController.actualDistance}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label for="remainFuel">剩余油量</label>
						</td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="remainFuel" maxlength="8" type="number"
								value="#{carOrderController.remainFuel}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="currentKilometers">当前公里数</label></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="currentKilometers" required="true"
								requiredMessage="请填写当前公里数！" maxlength="8" type="number"
								value="#{carOrderController.currentKilometers}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="candriveKilometers">剩余公里数</label></td>
						<td class="hengbiaogedata"><p:inputText style="width:140px"
								id="candriveKilometers" required="true"
								requiredMessage="请填写剩余公里数！" maxlength="8" type="number"
								value="#{carOrderController.candriveKilometers}">
							</p:inputText></td>
					</tr>
				</table>
				<div align="center">
					<p:commandButton styleClass="commonbtn" value="确定"
						onstart="return checkNulls('chargeForm','redfont',true);"
						action="#{carOrderController.chargeFee}"
						oncomplete="afterCheckFee(xhr,status,args)"
						update=":listForm:listTable,:maintainForm,:message" />
					<p:commandButton onclick="chargeDialog.hide()" type="button"
						styleClass="cancelbtn" value="" />
				</div>
			</h:form>
		</p:dialog>

	</h:body>
	<script type="text/javascript">
		function afterCheckOutData(xhr, status, args) {
			if (args.validate) {
				checkDialog.show();
			}
		}
		function afterEnsureDrawOut(xhr, status, args) {
			if (args.validate) {
				checkDialog.hide();
			}
		}
		function afterCheckFee(xhr, status, args) {
			if (args.validate) {
				chargeDialog.hide();
			}
		}
		function afterCheckInData(xhr, status, args) {
			if (args.validate) {
				chargeDialog.show();
			}
		}
		function showTag(xhr, status, args) {
			if (args.success) {
				parent.showTag("financeManage/temppay.jsf?priceTypeId="
						+ args.priceTypeId + "&amp;olderId=" + args.olderId
						+ "&amp;tableName=" + args.tableName + "&amp;key="
						+ args.orderId);
			}
		}
	</script>

</f:view>
</html>