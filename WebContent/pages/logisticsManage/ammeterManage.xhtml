<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css" ></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	    <script type="text/javascript" src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
	<script type="text/javascript" src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	<h:outputScript library="javax.faces" name="jsf.js" target="head" />
	</h:head>
	<h:body>
	<p:growl id="messages"></p:growl>
	<h:form id="headForm">
		<h:panelGrid columns="15">
			<h:outputLabel value="房间:" for="headForm:roomNameText"  />
			<h:panelGroup>
				<p:inputText id="roomNameText" style="width:145px;" /> 
				<his:IME for="headForm:roomNameText"
				 	fitcol="roomName" resultcol="1" rawSQL="true"
				 	SQL="#{ammeterManageController.selectRoomNameSql}"
					SQLResult="房间ID:0:hide,房间:1,楼层:2,大厦:3"
					multiresult="headForm:roomIdHd;0">
				 </his:IME>
				<h:inputHidden id="roomIdHd" value="#{ammeterManageController.roomId}" />
			</h:panelGroup>		
			<h:outputLabel value="是否可用:" for="validFlagText" />
			<h:selectOneMenu value="#{ammeterManageController.validFlag}" id="validFlagText" 
			class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">  
				<f:selectItem itemLabel="全部" itemValue="0" />
				<f:selectItem itemLabel="可用" itemValue="1" />
				<f:selectItem itemLabel="不可用" itemValue="2"/>
			</h:selectOneMenu>	
			<p:commandButton id="searchButton"
				action="#{ammeterManageController.selectAmmeterRecords}"
				styleClass="searchbtn" value=""
				update=":dataTableForm:vacationApplicationTable,:maintainForm,:messages" />
			<p:commandButton oncomplete="clearSelectForm()" styleClass="blankbtn" value="" 
						action="#{ammeterManageController.clearSelectForm}" update=":headForm,:messages"/>
		</h:panelGrid>
	</h:form>
	<h:form id="dataTableForm">
			<h:panelGrid id="vacationAppalicationRecord"  style="width:100%">
				<p:dataTable cellspacing="8" rows="10" style="width:100%"
					id="vacationApplicationTable" rowIndexVar="row"
					value="#{ammeterManageController.records}"
					var="record" rowKey="#{record.id}" selectionMode="multiple" emptyMessage="没有相应记录"
					selection="#{ammeterManageController.selectedRows}"
					paginator="true" paginatorPosition="bottom"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
					paginatorAlwaysVisible="false"
					>
					<p:ajax event="rowSelect" listener="#{ammeterManageController.selectRecord}" update=":dataTableForm,:maintainForm"/>
					<p:ajax event="rowUnselect" listener="#{ammeterManageController.unSelectRecord}" update=":dataTableForm,:maintainForm"/>
					<p:column headerText="电表名称">
						<h:outputText value="#{record.ammeterName}" />
					</p:column>
					<p:column headerText="大厦">
						<h:outputText value="#{record.buildName}" />
					</p:column>
					<p:column headerText="楼层">
						<h:outputText value="#{record.floorName}" />
				    </p:column>
					<p:column headerText="房间">
						<h:outputText value="#{record.roomName}" />
					</p:column>
					<p:column headerText="初始读数">
						<h:outputText value="#{record.initDegreeNumber}">
							<f:convertNumber pattern="0.00"></f:convertNumber>
						</h:outputText>
					</p:column>
					<p:column headerText="初始日期">
						<h:outputText value="#{record.initDatetime}">
							<f:convertDateTime pattern="yyyy-MM-dd HH:mm"  timeZone="GMT+8" ></f:convertDateTime>
						</h:outputText>
					</p:column>
					<p:column headerText="是否可用">
						<h:outputText value="可用" rendered="#{record.validFlag == 1}" />
						<h:outputText value="不可用" rendered="#{record.validFlag != 1}" />
					</p:column>
					<p:column headerText="备注">
						<h:outputText value="#{record.note}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
	</h:form>
	<h:form id="maintainForm">
		<div align="center">
			<p:commandButton styleClass="addbtn" value="" 
				action="#{ammeterManageController.clearInsertForm}"
				oncomplete="insertRecordDialog.show()"
				update=":insertForm" />
				<p:commandButton styleClass="modifybtn" value=""	disabled="#{ammeterManageController.disUpdateButton}"
				action="#{ammeterManageController.copyRecordUpdatedRow}" 
				oncomplete="updateRecordDialog.show()"
				update=":updateForm,:messages" />
				<p:commandButton styleClass="deletebtn" value="" disabled="#{ammeterManageController.disDeleteButton}"
				onclick="confirmDialog.show()" type="button"/>
		</div>
	</h:form>
	<p:dialog header="新增" widgetVar="insertRecordDialog"
		resizable="false"  appendTo="@(body)" position="center"
		modal="true" >
		<h:form id="insertForm">
			<table class="hengbiaoge" 
				id="insertTable">
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="电表名称:" for="ammeterNameText"  styleClass="redfont"/></td>
					<td class="hengbiaogedata"><p:inputText id="ammeterNameText" style="width:140px" required="true"
						requiredMessage="请输入电表名称!" value="#{ammeterManageController.insertedRow.ammeterName}" /></td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="是否可用" for="validFlag" /></td>
					<td class="hengbiaogedata">
						<h:selectOneMenu style="width:150px"
							value="#{ammeterManageController.insertedRow.validFlag}" id="validFlag" 
							class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">  
								<f:selectItem itemLabel="可用" itemValue="1" />
								<f:selectItem itemLabel="不可用" itemValue="2"/>
						</h:selectOneMenu>
					</td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="房间:" for="roomText" styleClass="redfont" /></td>
					<td class="hengbiaogedata"><h:panelGroup>
						<p:inputText id="roomText" style="width:140px;" required="true" requiredMessage="请输入房间" 
						value="#{ammeterManageController.insertedRow.roomName}">
						</p:inputText> 
						<his:IME for="insertForm:roomText"
						 	fitcol="roomName" resultcol="1" rawSQL="true"
						 	SQL="#{ammeterManageController.insertRoomNameSql}"
							SQLResult="房间ID:0:hide,房间:1,楼层:2,大厦:3"
							multiresult="insertForm:roomIdHd;0,insertForm:floorText;2,insertForm:buildingText;3" >
						 </his:IME>
						<h:inputHidden id="roomIdHd" value="#{ammeterManageController.insertedRow.roomId}" /></h:panelGroup>
					</td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="初始读数:" for="initDegreesTextAdd" styleClass="redfont"/></td>
					<td class="hengbiaogedata"><p:inputText id="initDegreesTextAdd" style="width:140px" value="#{ammeterManageController.insertedRow.initDegreeNumber}" 
					converterMessage="读数必须为两位正小数!如:100.12" required="true"
								requiredMessage="读数不能为空！" validatorMessage="读数必须为两位正小数!如:100.12">
							<f:validateDoubleRange minimum="0.01"
									for="insertForm:initDegreesTextAdd" />
					</p:inputText>
					</td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="楼层:" for="floorText" /></td>
					<td class="hengbiaogedata"><p:inputText id="floorText"  style="width:140px" 
						readonly="true"	value="#{ammeterManageController.insertedRow.floorName}" /></td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="初始日期:" for="initDateCalendarAdd" styleClass="redfont"/></td>
					<td class="hengbiaogedata">
						<p:calendar id="initDateCalendarAdd" value="#{ammeterManageController.insertedRow.initDatetime}"
						pattern="yyyy-MM-dd HH:mm" timeZone="GMT+8" size="20"  required="true" requiredMessage=" 初始日期不能为空！"></p:calendar>
					</td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="大厦:" for="buildingText" /></td>
					<td class="hengbiaogedata"><p:inputText id="buildingText" style="width:140px" 
						readonly="true" value="#{ammeterManageController.insertedRow.buildName}" /></td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="备注:" for="noteText" /></td>
					<td class="hengbiaogedata"><p:inputText id="noteText"  style="width:140px"
					 value="#{ammeterManageController.insertedRow.note}"/></td>
				</tr>
				
			</table>
			<div style="width: 100%; text-align: center;">
			<p:commandButton styleClass="submitbtn" value="" 
			action="#{ammeterManageController.insertAmmeterRecord}" 
			update=":insertForm,:dataTableForm,:messages,:maintainForm"
			oncomplete="handleInsertComplete(xhr, status, args)"
			/>
			<p:commandButton type="reset" styleClass="cancelbtn" value=""
				onclick="insertRecordDialog.hide()">
			</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
	<p:dialog header="修改" widgetVar="updateRecordDialog"
		resizable="false"  appendTo="@(body)" position="center"
		modal="true">
		<h:form id="updateForm">
			<table class="hengbiaoge" 
				id="updateTable">
					<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="电表名称:" for="ammeterNameText"  styleClass="redfont"/></td>
					<td class="hengbiaogedata"><p:inputText id="ammeterNameText" style="width:140px" required="true"
						requiredMessage="请输入电表名称!" value="#{ammeterManageController.updatedRow.ammeterName}" /></td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="是否可用" for="validFlag" /></td>
					<td class="hengbiaogedata">
						<h:selectOneMenu style="width:150px"
							value="#{ammeterManageController.updatedRow.validFlag}" id="validFlag" 
							class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">  
								<f:selectItem itemLabel="可用" itemValue="1" />
								<f:selectItem itemLabel="不可用" itemValue="2"/>
						</h:selectOneMenu>
					</td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="房间:" for="roomText" styleClass="redfont" /></td>
					<td class="hengbiaogedata"><h:panelGroup>
						<p:inputText id="roomText" style="width:140px;" required="true" requiredMessage="请输入房间" value="#{ammeterManageController.updatedRow.roomName}">
							<p:ajax event="blur" listener="#{ammeterManageController.fillField(ammeterManageController.updatedRow)}"
							update=":updateForm" process="@this,:updateForm:roomIdHd" />
						</p:inputText> 
						<his:IME for="updateForm:roomText"
						 	fitcol="roomName" resultcol="1" rawSQL="true"
						 	SQL="#{ammeterManageController.insertRoomNameSql}"
							SQLResult="房间ID:0:hide,房间:1,楼层:2,大厦:3"
							multiresult="updateForm:roomIdHd;0,updateForm:floorText;2,updateForm:buildingText;3" >
						 </his:IME>
						<h:inputHidden id="roomIdHd" value="#{ammeterManageController.updatedRow.roomId}" /></h:panelGroup>
					</td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="初始读数:" for="initDegreesTextEdit" styleClass="redfont"/></td>
					<td class="hengbiaogedata"><p:inputText id="initDegreesTextEdit" style="width:140px" value="#{ammeterManageController.updatedRow.initDegreeNumber}" 
					converterMessage="读数必须为两位正小数!如:100.12" required="true"
								requiredMessage="读数不能为空！" validatorMessage="读数必须为两位正小数!如:100.12">
							<f:validateDoubleRange minimum="0.01"
									for="insertForm:initDegreesTextEdit" />
					</p:inputText>
					</td>
				</tr>
				<tr>	
					<td class="hengbiaogeHeader1"><h:outputLabel value="楼层:" for="floorText" /></td>
					<td class="hengbiaogedata"><p:inputText id="floorText"  style="width:140px" 
						readonly="true"	value="#{ammeterManageController.updatedRow.floorName}" /></td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="初始日期:" for="initDateCalendarEdit" styleClass="redfont"/></td>
					<td class="hengbiaogedata">
						<p:calendar id="initDateCalendarEdit" value="#{ammeterManageController.updatedRow.initDatetime}"
						pattern="yyyy-MM-dd HH:mm" timeZone="GMT+8" size="20" required="true" requiredMessage="初始日期不能为空！"></p:calendar>
					</td>
				</tr>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputLabel value="大厦:" for="buildingText" /></td>
					<td class="hengbiaogedata"><p:inputText id="buildingText" style="width:140px" 
						readonly="true" value="#{ammeterManageController.updatedRow.buildName}" /></td>
					<td class="hengbiaogeHeader1"><h:outputLabel value="备注:" for="noteText" /></td>
					<td class="hengbiaogedata"><p:inputText id="noteText"  style="width:140px"
					 value="#{ammeterManageController.updatedRow.note}"/></td>
				</tr>
				
			</table>
			<div style="width: 100%; text-align: center;">
			<p:commandButton styleClass="submitbtn" value="" 
			action="#{ammeterManageController.updateAmmeterRecord}" 
			oncomplete="handleUpdateComplete(xhr, status, args)"
			update=":updateForm,:dataTableForm,:messages,:maintainForm"/>
			<p:commandButton type="reset" styleClass="cancelbtn" value=""
				onclick="updateRecordDialog.hide()">
			</p:commandButton>
			</div>
		</h:form>
	</p:dialog>
	<p:confirmDialog modal="true" appendTo="@(body)"
		widgetVar="confirmDialog" message="确定要删除该申请记录？">
		<h:form>
			<p:commandButton styleClass="commonbtn"  value="确定"
				action="#{ammeterManageController.deleteAmmeterRecord}"
				update=":dataTableForm,:maintainForm,:messages"
				oncomplete="confirmDialog.hide();">
			</p:commandButton>
			<p:commandButton styleClass="commonbtn"  value="取消" type="reset"
				onclick="confirmDialog.hide();"></p:commandButton>
		</h:form>
	</p:confirmDialog>
	
	<script type="text/javascript">
		//清空 selectForm
		function clearSelectForm(){
			document.getElementById("headForm:roomNameText").value="";
			
			return true;
		}
		function handleInsertComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				insertRecordDialog.hide();
            }	
		}
		function handleUpdateComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				updateRecordDialog.hide();
            }	
		}
		
	</script>
	</h:body>
</f:view>
</html>