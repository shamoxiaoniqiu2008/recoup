<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:his="http://centling.his.net/histag"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/common.js?ver=#{projectConfig.ver}" />
	</h:head>
	<style>
.overdiv {
	cursor: pointer;
	display: block;
	font-size: 12px;
	overflow: hidden;
	height: 18px;
	width: 70px;
	border: 0px solid #e6e6e6;
}

.overdivscroll {
	cursor: pointer;
	display: block;
	font-size: 12px;
	overflow: auto;
	height: 90px;
	width: 80px;
	border: 0px solid #e6e6e6;
}
</style>
	<h:body>
		<p:growl id="messages" widgetVar="message"></p:growl>
		<h:form id="headForm">
			<h:panelGrid columns="15">
				<h:outputText value="&nbsp;&nbsp;提交时间:" style="width:80" />
				<p:calendar id="startDate" pattern="yyyy-MM-dd" size="15"
					value="#{moveApplyController.startDate}" />
				<h:outputText value="至:" style="width:80" />
				<p:calendar id="endDate" pattern="yyyy-MM-dd" size="15"
					value="#{moveApplyController.endDate}" />
				<h:outputLabel value="老人姓名:" for="headForm:nameText" />
				<h:panelGroup>
					<p:inputText id="nameText" style="width:120px" />
					<his:IME for="headForm:nameText" fitcol="inputCode" resultcol="0"
						lock="true" rawSQL="true"
						SQL="#{moveApplyController.olderNameSql}"
						SQLResult="老人姓名:0,大厦:1,楼层:2,房间:3,床位:4,老人Id:5:hide,输入码:6"
						multiresult="headForm:olderIdHd;5" />
					<h:inputHidden id="olderIdHd"
						value="#{moveApplyController.olderId}" />
				</h:panelGroup>
				<h:outputLabel value="是否提交:" for="submitFlagText" />
				<h:selectOneMenu value="#{moveApplyController.submitFlag}"
					id="submitFlagText"
					class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
					<f:selectItem itemLabel="全部" itemValue="0" />
					<f:selectItem itemLabel="已提交" itemValue="1" />
					<f:selectItem itemLabel="未提交" itemValue="2" />
				</h:selectOneMenu>
				<h:outputLabel value="是否审批:" for="approveFlagText" />
				<h:selectOneMenu value="#{moveApplyController.approveFlag}"
					id="approveFlagText"
					class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
					<f:selectItem itemLabel="全部" itemValue="0" />
					<f:selectItem itemLabel="已审批" itemValue="1" />
					<f:selectItem itemLabel="未审批" itemValue="2" />
				</h:selectOneMenu>
				<p:commandButton id="searchButton"
					action="#{moveApplyController.selectMoveApplicationRecords}"
					styleClass="searchbtn" value=""
					update=":dataTableForm:MoveApplicationTable,:maintainForm,:messages,:changeRoomForm" />
				<p:commandButton oncomplete="clearSelectForm()"
					styleClass="blankbtn" value=""
					action="#{moveApplyController.clearSelectForm}"
					update=":headForm,:messages" />
			</h:panelGrid>
		</h:form>
		<h:form id="dataTableForm">
			<h:panelGrid id="vacationAppalicationRecord" style="width:100%">
				<p:dataTable cellspacing="8" rows="7" style="width:100%"
					id="MoveApplicationTable" rowIndexVar="row"
					value="#{moveApplyController.records}" var="record"
					rowKey="#{record.id}" selectionMode="single" emptyMessage="没有相应记录"
					selection="#{moveApplyController.selectedRow}" paginator="true"
					paginatorPosition="bottom" paginatorAlwaysVisible="false"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
					<p:ajax event="rowSelect"
						listener="#{moveApplyController.selectRecord}"
						update=":dataTableForm,:maintainForm,:changeRoomForm" />
					<p:ajax event="rowUnselect"
						listener="#{moveApplyController.unSelectRecord}"
						update=":dataTableForm,:maintainForm,:changeRoomForm" />
					<p:column headerText="姓名" styleClass="width50">
						<h:outputText value="#{record.olderName}" />
					</p:column>
					<p:column headerText="床位" styleClass="width60">
						<h:outputText value="#{record.bedName}" />
					</p:column>
					<p:column headerText="搬家类别" styleClass="width60">
						<h:outputText value="调房" rendered="#{record.moveType == 1}" />
						<h:outputText value="更换家具" rendered="#{record.moveType == 2}" />
					</p:column>
					<p:column headerText="搬家明细" styleClass="width60">
						<div title="点击查看更多" onDblClick="changeme(this);"
							onselectstart="return false" class="overdiv">
							#{record.moveDetail}</div>
					</p:column>
					<p:column headerText="已提交" styleClass="width50">
						<h:outputText value="是" rendered="#{record.sendFlag == 1}" />
						<h:outputText value="否" rendered="#{record.sendFlag == 2}" />
					</p:column>
					<p:column headerText="提交时间" styleClass="width120">
						<h:outputText value="#{record.applyTime}">
							<f:convertDateTime pattern="yyyy-MM-dd HH:mm" timeZone="GMT+8" />
						</h:outputText>
					</p:column>
					<p:column headerText="审批结果" styleClass="width60">
						<h:outputText value="同意" rendered="#{record.approvalResult == 1}" />
						<h:outputText value="不同意" rendered="#{record.approvalResult == 2}" />
						<h:outputText value="未审批"
							rendered="#{record.approvalResult == null}" />
					</p:column>
					<p:column headerText="已处理" styleClass="width50">
						<h:outputText value="是" rendered="#{record.finishFlag== 1}" />
						<h:outputText value="否" rendered="#{record.finishFlag== 2}" />
					</p:column>
					<p:column headerText="处理详情" styleClass="width60">
						<div title="点击查看更多" onDblClick="changeme(this);"
							onselectstart="return false" class="overdiv">
							#{record.note}</div>
					</p:column>
					<p:column headerText="处理时间" styleClass="width120">
						<h:outputText value="#{record.finishTime}">
							<f:convertDateTime pattern="yyyy-MM-dd HH:mm" timeZone="GMT+8" />
						</h:outputText>
					</p:column>
					<p:column headerText="处理人" styleClass="width50">
						<h:outputText value="#{record.processorName}" />
					</p:column>
					<p:column headerText="已录费" styleClass="width50">
						<h:outputText value="是" rendered="#{record.payFlag== 1}" />
						<h:outputText value="否" rendered="#{record.payFlag== 2}" />
					</p:column>
					<p:column headerText="确认人" styleClass="width50">
						<h:outputText value="#{record.ensureEmpName}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
		</h:form>
		<h:form id="maintainForm">
			<div align="center">
				<p:commandButton styleClass="addbtn" value=""
					action="#{moveApplyController.clearInsertForm}"
					oncomplete="insertRecordDialog.show()" update=":insertForm" />
				<p:commandButton styleClass="deletebtn" value=""
					disabled="#{moveApplyController.disDeleteAndSubmitButton}"
					onclick="confirmDialog.show()" type="button" />
				<p:commandButton styleClass="modifybtn" value=""
					disabled="#{moveApplyController.disUpdateButton}"
					action="#{moveApplyController.copyRecordUpdatedRow}"
					oncomplete="handleUpdateInit(xhr, status, args)"
					update=":updateForm,:messages" />
				<p:commandButton value="提交" styleClass="commonbtn"
					disabled="#{moveApplyController.disDeleteAndSubmitButton}"
					action="#{moveApplyController.submitMoveApplicationRecord}"
					update=":dataTableForm,:maintainForm,:messages,:changeRoomForm" />
				<p:commandButton value="搬家确认" styleClass="commonbtn"
					disabled="#{moveApplyController.disDeleteAndSubmitButton}"
					action="#{moveApplyController.checkBeHandled}"
					update=":messages,:noteForm"
					oncomplete="handleHandleInit(xhr, status, args)" />
				<p:commandButton styleClass="commonbtn" value="费用录入"
					action="#{moveApplyController.checkBePayed}" update=":messages"
					oncomplete="showTag(xhr, status, args)"
					disabled="#{moveApplyController.disUpdateButton}" />
			</div>
		</h:form>
		<h:form id="changeRoomForm">
			<h:panelGrid id="changeRoomRecord" style="width:100%"
				rendered="#{moveApplyController.changeRoomRenderedFlag}">
				<p:dataTable cellspacing="8" rows="10" style="width:100%"
					id="changeRoomTable" rowIndexVar="row"
					value="#{moveApplyController.changeRoomRecords}" var="record"
					rowKey="#{record.id}" emptyMessage="没有相应记录" paginator="true"
					paginatorPosition="bottom" paginatorAlwaysVisible="false"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
					<p:column headerText="姓名">
						<h:outputText value="#{record.olderName}" />
					</p:column>
					<p:column headerText="旧大厦">
						<h:outputText value="#{record.oldBuildName}" />
					</p:column>
					<p:column headerText="旧楼层">
						<h:outputText value="#{record.oldFloorName}" />
					</p:column>
					<p:column headerText="旧房间">
						<h:outputText value="#{record.oldRoomName}" />
					</p:column>
					<p:column headerText="旧床位">
						<h:outputText value="#{record.oldBedName}" />
					</p:column>
					<p:column headerText="新大厦">
						<h:outputText value="#{record.newBuildName}" />
					</p:column>
					<p:column headerText="新楼层">
						<h:outputText value="#{record.newFloorName}" />
					</p:column>
					<p:column headerText="新房间">
						<h:outputText value="#{record.newRoomName}" />
					</p:column>
					<p:column headerText="新床位">
						<h:outputText value="#{record.newBedName}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
		</h:form>
		<p:dialog header="新增" widgetVar="insertRecordDialog" resizable="false"
			appendTo="@(body)" position="400,100" modal="true">
			<h:form id="insertForm">
				<table class="hengbiaoge" width="100%" id="insertTable">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="老人姓名:"
								for="nameText" styleClass="redfont" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><h:panelGroup>
								<p:inputText id="nameText" style="width:125px" required="true"
									requiredMessage="请输入老人姓名!"
									value="#{moveApplyController.insertedRow.olderName}">
									<p:ajax event="blur"
										listener="#{moveApplyController.fillField}"
										update=":insertForm" process="@this,olderIdHd" />
								</p:inputText>
								<his:IME for="insertForm:nameText" fitcol="inputCode"
									resultcol="0" lock="true" rawSQL="true"
									SQL="#{moveApplyController.olderNameSql}"
									SQLResult="老人姓名:0,大厦:1,楼层:2,房间:3,床位:4,老人Id:5:hide,输入码:6,床位ID:9:hide"
									multiresult="insertForm:buildingText;1,insertForm:roomText;3,insertForm:bedNoText;4
							,insertForm:olderIdHd;5,insertForm:oldbedIdHd;7" />
								<h:inputHidden id="olderIdHd"
									value="#{moveApplyController.insertedRow.olderId}" />
								<h:inputHidden id="oldbedIdHd"
									value="#{moveApplyController.insertedRow.bedId}" />

							</h:panelGroup></td>
						<td class="hengbiaogeHeader1"><h:outputLabel value="搬家类别"
								for="moveTypeText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px">
							<h:selectOneMenu style="width:135px"
								value="#{moveApplyController.insertedRow.moveType}"
								id="moveTypeText"
								class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
								<f:selectItem itemLabel="调房" itemValue="1" />
								<f:selectItem itemLabel="更换家具/其他" itemValue="2" />
							</h:selectOneMenu>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="大厦:"
								for="buildingText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="buildingText" style="width:125px" readonly="true"
								value="#{moveApplyController.insertedRow.buildName}" /></td>
						<td class="hengbiaogeHeader1" rowspan="3"><h:outputLabel
								value="搬家明细:" for="moveDetailText" styleClass="redfont" /></td>
						<td class="hengbiaogedata" rowspan="3"
							style="padding: 0px 0px 0px 0px"><p:inputTextarea
								id="moveDetailText" style="width:125px;height:80px"
								required="true" requiredMessage="请输入搬家明细!"
								value="#{moveApplyController.insertedRow.moveDetail}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="房间:"
								for="roomText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="roomText" style="width:125px" readonly="true"
								value="#{moveApplyController.insertedRow.roomName}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="床位号:"
								for="bedNoText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="bedNoText" style="width:125px" readonly="true"
								value="#{moveApplyController.insertedRow.bedName}" /></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton styleClass="commonbtn" value="提交"
						action="#{moveApplyController.insertAndSubmitMoveApplicationRecord}"
						update=":insertForm,:dataTableForm,:messages,:maintainForm,:changeRoomForm"
						oncomplete="handleInsertComplete(xhr, status, args)" />
					<p:commandButton styleClass="commonbtn" value="保存"
						action="#{moveApplyController.insertMoveApplicationRecord}"
						update=":insertForm,:dataTableForm,:messages,:maintainForm,:changeRoomForm"
						oncomplete="handleInsertComplete(xhr, status, args)" />
					<p:commandButton type="reset" styleClass="commonbtn" value="关闭"
						onclick="insertRecordDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<p:dialog header="修改" widgetVar="updateRecordDialog" resizable="false"
			appendTo="@(body)" position="center" modal="true">
			<h:form id="updateForm">
				<table class="hengbiaoge" width="100%" id="updateTable">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="老人姓名:"
								for="nameText" styleClass="redfont" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="nameText" style="width:125px" readonly="true"
								value="#{moveApplyController.updatedRow.olderName}" /></td>
						<td class="hengbiaogeHeader1"><h:outputLabel value="搬家类别"
								for="moveTypeText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><h:selectOneMenu
								style="width:135px"
								value="#{moveApplyController.updatedRow.moveType}"
								id="moveTypeText"
								class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
								<f:selectItem itemLabel="调房" itemValue="1" />
								<f:selectItem itemLabel="更换家具/其他" itemValue="2" />
							</h:selectOneMenu></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="大厦:"
								for="buildingText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="buildingText" style="width:125px" readonly="true"
								value="#{moveApplyController.updatedRow.buildName}" /></td>
						<td class="hengbiaogeHeader1" rowspan="3"><h:outputLabel
								value="搬家明细:" for="moveDetailText" styleClass="redfont" /></td>
						<td class="hengbiaogedata" rowspan="3"
							style="padding: 0px 0px 0px 0px"><p:inputTextarea
								id="moveDetailText" style="width:125px;height:80px"
								required="true" requiredMessage="请输入搬家明细!"
								value="#{moveApplyController.updatedRow.moveDetail}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="房间:"
								for="roomText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="roomText" style="width:125px" readonly="true"
								value="#{moveApplyController.updatedRow.roomName}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="床位号:"
								for="bedNoText" /></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px"><p:inputText
								id="bedNoText" style="width:125px" readonly="true"
								value="#{moveApplyController.updatedRow.bedName}" /></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton styleClass="submitbtn" value=""
						action="#{moveApplyController.updateMoveApplicationRecord}"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						update=":updateForm,:dataTableForm,:messages,:maintainForm,:changeRoomForm" />
					<p:commandButton type="reset" styleClass="cancelbtn" value=""
						onclick="updateRecordDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<p:confirmDialog modal="true" appendTo="@(body)"
			widgetVar="confirmDialog" message="确定要删除该申请记录？">
			<h:form>
				<p:commandButton styleClass="commonbtn" value="确定"
					action="#{moveApplyController.deleteMoveApplicationRecord}"
					update=":dataTableForm,:maintainForm,:messages"
					oncomplete="confirmDialog.hide();">
				</p:commandButton>
				<p:commandButton styleClass="commonbtn" value="取消" type="reset"
					onclick="confirmDialog.hide();"></p:commandButton>
			</h:form>
		</p:confirmDialog>

		<p:confirmDialog modal="true" appendTo="@(body)" widgetVar="payDialog"
			message="您确认已缴费？确定后将不能再缴费！">
			<h:form>
				<p:commandButton styleClass="commonbtn" value="确定"
					action="#{moveApplyController.payMoveApplicationRecord}"
					update=":dataTableForm,:maintainForm,:messages"
					oncomplete="payDialog.hide();">
				</p:commandButton>
				<p:commandButton styleClass="commonbtn" value="取消" type="reset"
					onclick="payDialog.hide();"></p:commandButton>
			</h:form>
		</p:confirmDialog>
		<p:dialog header="处理详情" widgetVar="noteDialog" resizable="false"
			appendToBody="true" position="center" modal="true">
			<h:form id="noteForm">
				<table class="hengbiaoge" width="100%" id="reasonTable">
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="noteText">处理详情:</label></td>
						<td class="hengbiaogedata"><p:inputTextarea id="noteText"
								style="width:125px"
								value="#{moveApplyController.selectedRow.note}" /></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton styleClass="submitbtn" value=""
						onstart="return checkNulls('noteForm','redfont',true);"
						action="#{moveApplyController.handleMoveApplicationRecord}"
						update=":dataTableForm,:maintainForm,:messages,:changeRoomForm"
						oncomplete="handleHandleComplete(xhr, status, args)" />
					<p:commandButton type="reset" styleClass="cancelbtn" value=""
						onclick="noteDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<script type="text/javascript">
		//清空 selectForm
		function clearSelectForm(){
			document.getElementById("headForm:startDate").value="";
			document.getElementById("headForm:endDate").value="";
			document.getElementById("headForm:nameText").value="";
			return true;
		}
		function handleInsertComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				insertRecordDialog.hide();
            }	
		}
		function handleDeleteComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				confirmDialog.show();
            }	
		}
		function handleUpdateInit(xhr, status, args){
			if(args.success) {
				updateRecordDialog.show();
            }	
		}
		function handleUpdateComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				updateRecordDialog.hide();
            }	
		}
		function handlePayInit(xhr, status, args){
			if(args.success) {	
				payDialog.show();
			}
		}
		function showTag(xhr, status, args) {
			if(args.success) {	
				parent.showTag("financeManage/temppay.jsf?priceTypeId="+args.priceTypeId+"&amp;olderId="+args.olderId+"&amp;tableName="+args.tableName+"&amp;key="+args.applyId);
			}
		}

		function handleHandleComplete(xhr, status, args){
			if(!args.validationFailed) {
				noteDialog.hide();
            }	

		}
		
		function handleHandleInit(xhr, status, args){
			if(args.success) {
				noteDialog.show();
            }	

		}
		
		function changeme(obj){
   			if(obj.className=="overdiv"){
   				obj.className="overdivscroll";
   				obj.title="点击关闭";
   				//nowheightflage=true;
   			}else{
   				obj.scrollTop=0;
   				obj.className="overdiv";
   				obj.title="点击查看更多";
   			//	nowheightflage=false;
   			}
   		}
	</script>
	</h:body>
</f:view>
</html>