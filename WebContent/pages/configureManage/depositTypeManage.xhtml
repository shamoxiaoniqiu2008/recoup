<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
	</h:head>
	<h:body>
		<p:growl id="messages"></p:growl>
		<h:form id="headForm">
			<h:panelGrid columns="15">
				<h:outputText value="&nbsp;&nbsp;押金类别:" style="width:80" />
				<h:panelGroup>
					<p:inputText id="typeText" style="width:120px"
						value="#{depositTypeManageController.type}">
					</p:inputText>
					<his:IME for="headForm:typeText" fitcol="inputcode" resultcol="0"
						lock="true" rawSQL="true"
						SQL="#{depositTypeManageController.typeSql}"
						SQLResult="押金类别:0,输入码:1,主键:2:hide"
						multiresult="headForm:typeText;0,headForm:typeIdHd;2" />
					<h:inputHidden id="typeIdHd"
						value="#{depositTypeManageController.typeId}" />
				</h:panelGroup>
				<p:commandButton id="searchButton"
					action="#{depositTypeManageController.selectTypeRecords}"
					styleClass="searchbtn" value=""
					update=":dataTableForm:TypeTable,:maintainForm,:messages" />
				<p:commandButton oncomplete="clearSelectForm()"
					styleClass="blankbtn" value=""
					action="#{depositTypeManageController.clearSelectForm}"
					update=":headForm,:messages" />
			</h:panelGrid>
		</h:form>
		<h:form id="dataTableForm">
			<h:panelGrid id="typeRecord" style="width:100%">
				<p:dataTable cellspacing="8" rows="10" style="width:100%"
					id="TypeTable" rowIndexVar="row"
					value="#{depositTypeManageController.typeRecords}" var="record"
					rowKey="#{record.id}" selectionMode="multiple"
					emptyMessage="没有相应记录"
					selection="#{depositTypeManageController.selectedRows}"
					paginator="true" paginatorPosition="bottom"
					paginatorAlwaysVisible="false"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
					<p:ajax event="rowSelect"
						listener="#{depositTypeManageController.selectRecord}"
						update=":dataTableForm,:maintainForm" />
					<p:ajax event="rowUnselect"
						listener="#{depositTypeManageController.unSelectRecord}"
						update=":dataTableForm,:maintainForm" />
					<p:column headerText="类别">
						<h:outputText value="#{record.type}" />
					</p:column>
					<p:column headerText="输入码">
						<h:outputText value="#{record.inputcode}" />
					</p:column>
					<p:column headerText="金额">
						<h:outputText value="#{record.fee}" />
					</p:column>
				</p:dataTable>
			</h:panelGrid>
		</h:form>
		<h:form id="maintainForm">
			<div align="center">
				<p:commandButton styleClass="addbtn" value=""
					action="#{depositTypeManageController.clearInsertForm}"
					oncomplete="insertRecordDialog.show()" update=":insertForm" />
				<p:commandButton styleClass="deletebtn"
					disabled="#{depositTypeManageController.disDeleteButton}"
					onclick="confirmDialog.show()" type="button" value="" />
				<p:commandButton styleClass="modifybtn"
					disabled="#{depositTypeManageController.disUpdateButton}"
					action="#{depositTypeManageController.copyRecordUpdatedRow}"
					oncomplete="updateRecordDialog.show()" value=""
					update=":updateForm,:messages" />
			</div>
		</h:form>

		<p:dialog header="新增" widgetVar="insertRecordDialog" resizable="false"
			appendTo="@(body)" position="center" modal="true">
			<h:form id="insertForm">
				<table class="hengbiaoge" width="100%" id="insertTable">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="押金类别:"
								for="typeText" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText id="typeText"
								style="width:120px" required="true" requiredMessage="请输入押金类别!"
								value="#{depositTypeManageController.insertedRow.type}">
								<p:ajax event="blur"
									listener="#{depositTypeManageController.updateInputCode}"
									update=":insertForm:inputcodeText"></p:ajax>
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="输入码:"
								for="inputcodeText" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText id="inputcodeText"
								style="width:120px" required="true" requiredMessage="输入码不能为空!"
								value="#{depositTypeManageController.insertedRow.inputcode}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="金额:"
								for="feeText" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><h:panelGroup>
								<p:inputText id="feeText" style="width:120px"
									converterMessage="预交金必须为两位正小数!如:100.12"
									validatorMessage="预交金必须为两位正小数!如:100.12" required="true"
									requiredMessage="请输入金额!"
									value="#{depositTypeManageController.insertedRow.fee}">
									<f:validateDoubleRange minimum="0.01"
										for="insertRecordDialog:feeText" />
								</p:inputText>
							</h:panelGroup></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton styleClass="submitbtn" value=""
						action="#{depositTypeManageController.insertTypeRecord}"
						update=":insertForm,:dataTableForm,:messages,:maintainForm"
						oncomplete="handleInsertComplete(xhr, status, args)" />
					<p:commandButton type="reset" styleClass="cancelbtn" value=""
						onclick="insertRecordDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<p:dialog header="修改" widgetVar="updateRecordDialog" resizable="false"
			appendTo="@(body)" position="center" modal="true">
			<h:form id="updateForm">
				<table class="hengbiaoge" width="100%" id="updateTable">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="押金类别:"
								for="typeText" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText id="typeText"
								style="width:120px" required="true" requiredMessage="请输入押金类别!"
								value="#{depositTypeManageController.updatedRow.type}">
								<p:ajax event="blur"
									listener="#{depositTypeManageController.updateInputCode}"
									update=":updateForm:inputcodeText"></p:ajax>
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="输入码:"
								for="inputcodeText" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText id="inputcodeText"
								style="width:120px" required="true" requiredMessage="输入码不能为空!"
								value="#{depositTypeManageController.updatedRow.inputcode}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="金额:"
								for="feeText" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><h:panelGroup>
								<p:inputText id="feeText" style="width:120px"
									converterMessage="预交金必须为两位正小数!如:100.12"
									validatorMessage="预交金必须为两位正小数!如:100.12" required="true"
									requiredMessage="请输入押金!"
									value="#{depositTypeManageController.updatedRow.fee}">
									<f:validateDoubleRange minimum="0.01"
										for="updateRecordDialog:feeText" />
								</p:inputText>
							</h:panelGroup></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton styleClass="submitbtn" value=""
						action="#{depositTypeManageController.updateTypeRecord}"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						update=":updateForm,:dataTableForm,:messages,:maintainForm" />
					<p:commandButton type="reset" styleClass="cancelbtn" value=""
						onclick="updateRecordDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<p:confirmDialog modal="true" appendTo="@(body)"
			widgetVar="confirmDialog" message="确定要删除该类别记录？">
			<h:form>
				<p:commandButton styleClass="commonbtn" value="确定"
					action="#{depositTypeManageController.deleteTypeRecord}"
					update=":dataTableForm,:maintainForm,:messages"
					oncomplete="confirmDialog.hide();">
				</p:commandButton>
				<p:commandButton styleClass="commonbtn" value="取消" type="reset"
					onclick="confirmDialog.hide();"></p:commandButton>
			</h:form>
		</p:confirmDialog>

		<script type="text/javascript">
		//清空 selectForm
		function clearSelectForm(){
			document.getElementById("headForm:typeText").value="";
			return true;
		}
		function handleInsertComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				insertRecordDialog.hide();
            }	
		}
		function handleUpdateComplete(xhr, status, args){
			if(!args.validationFailed &amp;&amp; args.success) {
				updateRecordDialog.hide();
            }	
		}
		
	</script>
	</h:body>
</f:view>
</html>