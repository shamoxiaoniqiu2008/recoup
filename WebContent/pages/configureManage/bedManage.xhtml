<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html" style="width:100%">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>
	<h:body>
		<p:growl id="message"></p:growl>
		<h:form id="searchForm">
			<table>
				<tr>
					<td class="leftcell">#{pageConfig.buildName}:</td>
					<td><p:inputText id="buildNameText" style="width:145px;"
							value="#{bedManageController.buildName}">
							<p:ajax event="blur" listener="#{bedManageController.initSQL}"
								update=":searchForm">
							</p:ajax>
						</p:inputText> <his:IME for="searchForm:buildNameText" fitcol="name"
							resultcol="0" rawSQL="true" SQL="#{bedManageController.buildSQL}"
							SQLResult="#{pageConfig.buildName}:2">
						</his:IME></td>

					<td class="leftcell">#{pageConfig.floorName}:</td>
					<td><p:inputText id="floorNameText" style="width:145px;"
							value="#{bedManageController.floorName}">
							<p:ajax event="blur" listener="#{bedManageController.initSQL}"
								update=":searchForm">
							</p:ajax>
						</p:inputText> <his:IME for="searchForm:floorNameText" fitcol="name"
							resultcol="0" rawSQL="true" SQL="#{bedManageController.floorSQL}"
							SQLResult="#{pageConfig.floorName}:2,#{pageConfig.buildName}:3">
						</his:IME></td>

					<td class="leftcell">#{pageConfig.roomName}:</td>
					<td><p:inputText id="roomNameText" style="width:145px;"
							value="#{bedManageController.roomName}">
							<p:ajax event="blur" listener="#{bedManageController.initSQL}"
								update=":searchForm">
							</p:ajax>
						</p:inputText> <his:IME for="searchForm:roomNameText" fitcol="name"
							resultcol="0" rawSQL="true" SQL="#{bedManageController.roomSQL}"
							SQLResult="#{pageConfig.roomName}:1,#{pageConfig.floorName}:5,#{pageConfig.buildName}:4">
						</his:IME></td>

					<td class="leftcell">#{pageConfig.bedName}:</td>
					<td><p:inputText id="bedNameText" style="width:145px;"
							value="#{bedManageController.bedName}">
							<p:ajax event="blur" listener="#{bedManageController.initSQL}"
								update=":searchForm">
							</p:ajax>
						</p:inputText> <his:IME for="searchForm:bedNameText" fitcol="name" resultcol="0"
							rawSQL="true" SQL="#{bedManageController.bedSQL}"
							SQLResult="#{pageConfig.bedName}:5,#{pageConfig.roomName}:8,#{pageConfig.floorName}:7,#{pageConfig.buildName}:6">
						</his:IME></td>


					<td class="leftcell"><p:commandButton styleClass="searchbtn"
							value="" actionListener="#{bedManageController.selectBedRecords}"
							update=":form:bed,:message,:maintainForm:modifybtn,:maintainForm:deletebtn" /></td>
					<td class="leftcell"><p:commandButton styleClass="blankbtn"
							value="" process="@this"
							actionListener="#{bedManageController.clearSearchForm}"
							update=":searchForm,:form:bed,:message,:maintainForm:modifybtn,:maintainForm:deletebtn" /></td>
				</tr>
			</table>
		</h:form>
		<h:form id="form" style="width:100%">
			<p:dataTable id="bed" var="result" rowKey="#{result.id}"
				value="#{bedManageController.beds}"
				selection="#{bedManageController.selectedBed}"
				selectionMode="single" cellspacing="8" rows="10"
				style="white-space:nowrap;width:100%" rowIndexVar="row"
				emptyMessage="#{pageConfig.noRow}" paginator="true"
				paginatorPosition="bottom" paginatorAlwaysVisible="false"
				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

				<p:ajax event="rowSelect"
					listener="#{bedManageController.setEnableFlag}"
					update=":maintainForm:modifybtn,:maintainForm:deletebtn" />

				<p:ajax event="rowUnselect"
					listener="#{bedManageController.setUnableFlag}"
					update=":maintainForm:modifybtn,:maintainForm:deletebtn" />

				<p:column headerText="#{pageConfig.buildName}" style="width=100%">  
		            #{result.buildname}   
		        </p:column>

				<p:column headerText="#{pageConfig.floorName}" style="width=100%">  
		            #{result.floorname}   
		        </p:column>

				<p:column headerText="#{pageConfig.roomName}" style="width=100%">  
		            #{result.roomname}   
		        </p:column>

				<p:column headerText="#{pageConfig.bedName}" style="width=100%">  
		            #{result.name}   
		        </p:column>

				<p:column headerText="#{pageConfig.type}" style="width=100%">  
		            #{result.typename}   
		        </p:column>

				<p:column headerText="#{pageConfig.olderNumber}" style="width=100%">  
		            #{result.oldernumber}   
		        </p:column>
				<p:column headerText="#{pageConfig.notes}" style="width=100%">  
		            #{result.notes}   
		        </p:column>

			</p:dataTable>

		</h:form>
		<div align="center">
			<h:form id="maintainForm">
				<p:commandButton styleClass="addbtn" value=""
					actionListener="#{bedManageController.showAddForm}"
					oncomplete="addDialog.show()" update=":addForm" />
				<p:commandButton styleClass="modifybtn" value="" id="modifybtn"
					actionListener="#{bedManageController.showEditForm}"
					disabled="#{bedManageController.disabledFlag}"
					oncomplete="updateDialog.show()" update=":updateForm" />
				<p:commandButton styleClass="deletebtn" value="" id="deletebtn"
					onclick="confirmDelDialog.show()"
					disabled="#{bedManageController.disabledFlag}" type="button" />
			</h:form>
		</div>
		<p:dialog header="新增" widgetVar="addDialog" resizable="false"
			appendTo="@(body)" modal="true">
			<h:form id="addForm" styleClass="noDisable">
				<table class="hengbiaoge">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.bedName}:" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								required="true"
								requiredMessage="#{pageConfig.bedName}#{pageConfig.notBeEmpty}"
								id="bedName" value="#{bedManageController.selectedBed.name}">
							</p:inputText></td>
					</tr>

					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.roomName}:" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								id="RoomText" required="true"
								requiredMessage="#{pageConfig.roomName}#{pageConfig.notBeEmpty}"
								value="#{bedManageController.selectedBed.roomname}">
							</p:inputText> <his:IME for="addForm:RoomText" lock="true" fitcol="name"
								resultcol="3" rawSQL="true"
								SQL="select * from pension_room  where cleared = 2"
								SQLResult="id:0:hide,#{pageConfig.buildName}:4,#{pageConfig.floorName}:5,#{pageConfig.roomName}:1"
								multiresult="addForm:roomId;0,addForm:buildName;1,addForm:floorName;2,addForm:build_name;1,addForm:floor_name;2">
							</his:IME> <h:inputHidden id="roomId"
								value="#{bedManageController.selectedBed.roomId}">
							</h:inputHidden> <h:inputHidden id="build_name"
								value="#{bedManageController.selectedBed.buildname}">
							</h:inputHidden> <h:inputHidden id="floor_name"
								value="#{bedManageController.selectedBed.floorname}">
							</h:inputHidden></td>
					</tr>

					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.floorName}:" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								disabled="true" id="floorName"
								value="#{bedManageController.selectedBed.floorname}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.buildName}:" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								disabled="true" id="buildName"
								value="#{bedManageController.selectedBed.buildname}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.type}:" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								id="bedTypeText" required="true"
								requiredMessage="#{pageConfig.type}#{pageConfig.notBeEmpty}"
								value="#{bedManageController.selectedBed.typename}">
							</p:inputText> <his:IME for="addForm:bedTypeText" lock="true"
								fitcol="inputCode,level" resultcol="2" rawSQL="true"
								SQL="select * from pension_dic_bedType"
								SQLResult="id:0:hide,#{pageConfig.inputCode}:1,#{pageConfig.type}:2,#{pageConfig.notes}:3"
								multiresult="addForm:typeId;0">
							</his:IME> <h:inputHidden id="typeId"
								value="#{bedManageController.selectedBed.typeId}">
							</h:inputHidden></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.notes}:" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								value="#{bedManageController.selectedBed.notes}">
							</p:inputText></td>
					</tr>
				</table>
				<h:panelGrid id="buttonGrid" columns="3" style="margin:0px auto">
					<p:commandButton action="#{bedManageController.insertBedRecord}"
						styleClass="commonbtn" value="保存"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						update=":form:bed,:message,:maintainForm:modifybtn,:maintainForm:deletebtn">
					</p:commandButton>
					<p:commandButton styleClass="blankbtn" value="" process="@this"
						actionListener="#{bedManageController.clearAddForm}"
						update=":addForm" />
					<p:commandButton onclick="addDialog.hide()" styleClass="commonbtn"
						value="关闭" />
				</h:panelGrid>
			</h:form>
		</p:dialog>
		<p:dialog header="修改" widgetVar="updateDialog" resizable="false"
			appendTo="@(body)" modal="true">
			<h:form id="updateForm" styleClass="noDisable">
				<table class="hengbiaoge">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.bedName}:" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								required="true"
								requiredMessage="#{pageConfig.bedName}#{pageConfig.notBeEmpty}"
								id="bedName" value="#{bedManageController.selectedBed.name}">
							</p:inputText></td>
					</tr>

					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.roomName}:" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								id="RoomText" required="true"
								requiredMessage="#{pageConfig.roomName}#{pageConfig.notBeEmpty}"
								value="#{bedManageController.selectedBed.roomname}">
							</p:inputText> <his:IME for="updateForm:RoomText" lock="true" fitcol="name"
								resultcol="3" rawSQL="true"
								SQL="select * from pension_room  where cleared = 2"
								SQLResult="id:0:hide,#{pageConfig.buildName}:4,#{pageConfig.floorName}:5,#{pageConfig.roomName}:1"
								multiresult="updateForm:roomId;0,updateForm:buildName;1,updateForm:floorName;2,updateForm:build_name;1,updateForm:floor_name;2">
							</his:IME> <h:inputHidden id="roomId"
								value="#{bedManageController.selectedBed.roomId}">
							</h:inputHidden> <h:inputHidden id="build_name"
								value="#{bedManageController.selectedBed.buildname}">
							</h:inputHidden> <h:inputHidden id="floor_name"
								value="#{bedManageController.selectedBed.floorname}">
							</h:inputHidden></td>
					</tr>

					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.floorName}:" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								disabled="true" id="floorName"
								value="#{bedManageController.selectedBed.floorname}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.buildName}:" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								disabled="true" id="buildName"
								value="#{bedManageController.selectedBed.buildname}">
							</p:inputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.type}:" styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								id="bedTypeText" required="true"
								requiredMessage="#{pageConfig.type}#{pageConfig.notBeEmpty}"
								value="#{bedManageController.selectedBed.typename}">
							</p:inputText> <his:IME for="updateForm:bedTypeText" lock="true"
								fitcol="inputCode,level" resultcol="2" rawSQL="true"
								SQL="select * from pension_dic_bedType"
								SQLResult="id:0:hide,#{pageConfig.inputCode}:1,#{pageConfig.type}:2,#{pageConfig.notes}:3"
								multiresult="updateForm:typeId;0">
							</his:IME> <h:inputHidden id="typeId"
								value="#{bedManageController.selectedBed.typeId}">
							</h:inputHidden></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText
								value="#{pageConfig.notes}:" /></td>
						<td class="hengbiaogedata"><p:inputText style="width:220px"
								value="#{bedManageController.selectedBed.notes}">
							</p:inputText></td>
					</tr>
				</table>
				<h:panelGrid id="buttonGrid" columns="3" style="margin:0px auto">
					<p:commandButton action="#{bedManageController.insertBedRecord}"
						styleClass="commonbtn" value="保存"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						update=":form:bed,:message,:maintainForm:modifybtn,:maintainForm:deletebtn">
					</p:commandButton>
					<p:commandButton styleClass="blankbtn" value="" process="@this"
						actionListener="#{bedManageController.clearAddForm}"
						update=":updateForm" />
					<p:commandButton onclick="updateDialog.hide()"
						styleClass="commonbtn" value="关闭" />
				</h:panelGrid>
			</h:form>
		</p:dialog>
		<!-- 删除记录的dialog -->
		<p:dialog widgetVar="confirmDelDialog" resizable="false"
			appendToBody="true" modal="true" closable="true" header="删除数据">
			<h:form id="confirmDelForm">
				<h:panelGrid columns="1" style="text-align:center">
					<h:outputText value="你确定要删除此条数据？" style="font-size:14px;" />
					<h:panelGroup style="margin:0 auto;">
						<p:commandButton styleClass="submitbtn" value=""
							action="#{bedManageController.deleteBedRecord}"
							update=":form:bed,:message,:maintainForm:modifybtn,:maintainForm:deletebtn"
							oncomplete="confirmDelDialog.hide()"></p:commandButton>
						<p:commandButton styleClass="cancelbtn" value="" type="button"
							update=":form:bed,:message,:maintainForm:modifybtn,:maintainForm:deletebtn"
							onclick="confirmDelDialog.hide();"></p:commandButton>
					</h:panelGroup>
				</h:panelGrid>
			</h:form>
		</p:dialog>
	</h:body>

	<script type="text/javascript">
		function handleUpdateComplete(xhr, status, args) {
			if (!args.validationFailed) {
				addDialog.hide();
				updateDialog.hide();
			}

		}
	</script>
</f:view>
</html>