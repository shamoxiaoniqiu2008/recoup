<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:his="http://centling.his.net/histag"
	xmlns:p="http://primefaces.org/ui">
<f:view contentType="text/html">

	<style>
.ui-panel .ui-panel-content {
	padding: 0em !important;
}
</style>

	<h:head>
		<title>#{pageConfig.shiftChange}</title>


		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>

		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/common.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>

	<style>
.overdiv {
	cursor: pointer;
	display: block;
	font-size: 12px;
	overflow: hidden;
	height: 18px;
	width: 100px;
	border: 0px solid #e6e6e6;
}

.overdivscroll {
	cursor: pointer;
	display: block;
	font-size: 12px;
	overflow: auto;
	height: 90px;
	width: 100px;
	border: 0px solid #e6e6e6;
}
</style>
	<h:body>
		<p:growl id="message" widgetVar="message"></p:growl>
		<p:growl id="messages"></p:growl>
		<h:form id="searchForm" style="display: inline">
			<h:panelGrid columns="13">
				<h:outputText value="起始日期:" style="text-align:right" />
				<p:calendar id="startDate" pattern="yyyy-MM-dd"
					value="#{shiftChangeController.startDate}" />
				<h:outputText value="结束日期:" style="text-align:right" />
				<p:calendar id="endDate" pattern="yyyy-MM-dd"
					value="#{shiftChangeController.endDate}" />
				<h:outputText value="交接班类型:" style="text-align:right" />
				<h:selectOneMenu value="#{shiftChangeController.shiftFlag}"
					id="shiftFlag"
					class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
					<f:selectItem itemLabel="全部" />
					<f:selectItem itemValue="1" itemLabel="交班" />
					<f:selectItem itemValue="2" itemLabel="接班" />
				</h:selectOneMenu>
				<p:commandButton styleClass="searchbtn" value=""
					action="#{shiftChangeController.search}"
					update=":shiftChangeForm,:messages">
				</p:commandButton>
				<p:commandButton styleClass="commonbtn" value="清空"
					action="#{shiftChangeController.clearSearchForm}"
					update=":searchForm,:messages">
				</p:commandButton>
			</h:panelGrid>
		</h:form>

		<h:form id="shiftChangeForm">
			<table width="100%">
				<tr>
					<td><p:dataTable id="scheduleList" style="width:100%"
							cellspacing="2"
							value="#{shiftChangeController.shiftChangeRecords}"
							var="shiftChangeRecord" rowKey="#{shiftChangeRecord.id}"
							emptyMessage="当前无内容" selectionMode="single"
							selection="#{shiftChangeController.selectShiftChangeRecord}"
							rows="10" paginatorAlwaysVisible="false"
							paginatorPosition="bottom"
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
							paginator="true">
							<p:ajax event="rowSelect"
								listener="#{shiftChangeController.onShiftChangeRecordSelect}"
								update=":messages,:shiftChangeForm" />
							<p:ajax event="rowUnselect"
								listener="#{shiftChangeController.onShiftChangeRecordUnselect}"
								update=":messages,:shiftChangeForm" />
							<p:column headerText="部门名称" style="text-align:center"
								styleClass="width60">
								<h:outputText value="#{shiftChangeRecord.deptName}" />
							</p:column>
							<p:column headerText="交班人" style="text-align:center"
								styleClass="width80">
								<h:outputText value="#{shiftChangeRecord.shifterName}" />
							</p:column>
							<p:column headerText="接班人" style="text-align:center"
								styleClass="width80">
								<h:outputText value="#{shiftChangeRecord.successorName}" />
							</p:column>
							<p:column headerText="交班时间" style="text-align:center"
								styleClass="width120">
								<h:outputText value="#{shiftChangeRecord.changeTime}">
									<f:convertDateTime pattern="yyyy-MM-dd HH:mm" />
								</h:outputText>
							</p:column>
							<p:column headerText="新入住" style="text-align:center"
								styleClass="width50">
								<h:outputText value="#{shiftChangeRecord.newolderAmount}" />
							</p:column>
							<p:column headerText="出院" style="text-align:center"
								styleClass="width50">
								<h:outputText value="#{shiftChangeRecord.outhospAmount}" />
							</p:column>
							<p:column headerText="住院" style="text-align:center"
								styleClass="width50">
								<h:outputText value="#{shiftChangeRecord.inhospAmount}" />
							</p:column>
							<p:column headerText="回家" style="text-align:center"
								styleClass="width50">
								<h:outputText value="#{shiftChangeRecord.returnhomeAmount}" />
							</p:column>
							<p:column headerText="交接部门明细" style="text-align:center"
								styleClass="width500">
								<div title="点击查看更多" onDblClick="changeme(this);"
									onselectstart="return false" class="overdiv">
									#{shiftChangeRecord.changeContent}</div>
							</p:column>
							<p:column headerText="备注" style="text-align:center"
								styleClass="width150">
								<h:outputText value="#{shiftChangeRecord.note}">
								</h:outputText>
							</p:column>
						</p:dataTable></td>
				</tr>
			</table>
			<div align="center">
				<p:commandButton value="新增" styleClass="commonbtn" ajax="true"
					process="@this" action="#{shiftChangeController.add}"
					oncomplete="modifyDig.show()" update=":modifyForm,:messages">
				</p:commandButton>
				<p:commandButton value="修改" styleClass="commonbtn" ajax="true"
					process="@this,shiftChangeForm:checkSelectModifyData"
					action="#{shiftChangeController.modify}"
					oncomplete="afterCheckSelectData(xhr,status,args)"
					update=":modifyForm,:messages">
				</p:commandButton>
				<p:commandButton value="删除" styleClass="commonbtn" ajax="true"
					process="@this,shiftChangeForm:checkSelectModifyData"
					oncomplete="afterCheckDeleteData(xhr,status,args)"
					update=":messages">
				</p:commandButton>
				<p:commandButton value="提交" styleClass="commonbtn"
					rendered="#{shiftChangeController.selectShiftChangeRecord != null and shiftChangeController.employee.id == shiftChangeController.selectShiftChangeRecord.shifterId and shiftChangeController.selectShiftChangeRecord.sended == 2}"
					ajax="true" process="@this,shiftChangeForm:checkSelectSendData"
					action="#{shiftChangeController.send}"
					update=":shiftChangeForm,:messages">
				</p:commandButton>
				<p:commandButton value="确认" styleClass="commonbtn" id="affirmBtn"
					rendered="#{shiftChangeController.selectShiftChangeRecord != null and shiftChangeController.employee.id == shiftChangeController.selectShiftChangeRecord.successorId and shiftChangeController.selectShiftChangeRecord.sended == 1 and shiftChangeController.selectShiftChangeRecord.affirmed == 2}"
					ajax="true" process="@this,shiftChangeForm:checkSelectData"
					action="#{shiftChangeController.view}"
					oncomplete="afterCheckSelectData(xhr,status,args)"
					update=":modifyForm,:messages">
				</p:commandButton>
				<p:commandButton value="查看明细" styleClass="commonbtn"
					rendered="#{shiftChangeController.recordId == null}" ajax="true"
					process="@this,shiftChangeForm:checkSelectData"
					action="#{shiftChangeController.view}"
					oncomplete="afterCheckSelectData(xhr,status,args)"
					update=":modifyForm,:messages">
				</p:commandButton>
				<h:inputHidden id="checkSelectData" value="checkSelectData"
					validator="#{shiftChangeController.checkSelectData}"></h:inputHidden>
				<h:inputHidden id="checkSelectModifyData"
					value="checkSelectModifyData"
					validator="#{shiftChangeController.checkSelectModifyData}"></h:inputHidden>
				<h:inputHidden id="checkSelectSendData" value="checkSelectSendData"
					validator="#{shiftChangeController.checkSelectSendData}"></h:inputHidden>
			</div>
		</h:form>

		<p:confirmDialog message="是否确认删除该交班记录？" severity="alert"
			widgetVar="deleteConfirm" appendTo="@(body)">
			<h:form>
				<p:commandButton styleClass="submitbtn" value=""
					style="margin-left:80px;"
					actionListener="#{shiftChangeController.delete}"
					update=":shiftChangeForm:scheduleList,:messages" ajax="true"
					oncomplete="deleteConfirm.hide()" />
				<p:commandButton styleClass="cancelbtn" value=""
					onclick="deleteConfirm.hide()" type="button" />
			</h:form>
		</p:confirmDialog>
		<p:dialog widgetVar="modifyDig" width="680px" height="400px"
			appendTo="@(body)" resizable="true" header="交班记录" modal="true">
			<h:form id="modifyForm">
				<table style="width: 630px; height: 350px">
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="successorName">接班人</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><h:inputHidden
								value="#{shiftChangeController.selectShiftChangeRecord.successorId}"
								id="successorId"></h:inputHidden> <p:inputText
								style="width: 175px"
								value="#{shiftChangeController.selectShiftChangeRecord.successorName}"
								id="successorName" rendered="#{shiftChangeController.addFlag }">
							</p:inputText> <h:outputText
								value="#{shiftChangeController.selectShiftChangeRecord.successorName}"
								rendered="#{!shiftChangeController.addFlag }"></h:outputText> <his:IME
								for="modifyForm:successorName" fitcol="id,inputCode"
								resultcol="1" lock="true" rawSQL="true"
								SQL="#{shiftChangeController.addDeptSql}"
								SQLResult="编号:0:hide,姓名:1,输入码:2:hide"
								multiresult="modifyForm:successorId;0,modifyForm:successorName;1" />
						</td>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="newolderAmount">新入住老人数量</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:inputText
								style="width: 175px"
								value="#{shiftChangeController.newolderAmount}"
								id="newolderAmount"
								rendered="#{!shiftChangeController.viewFlag}"></p:inputText> <h:outputText
								value="#{shiftChangeController.newolderAmount}"
								rendered="#{shiftChangeController.viewFlag}"></h:outputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="outhospAmount">出院老人数量</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:inputText
								style="width: 175px"
								value="#{shiftChangeController.outhospAmount}"
								id="outhospAmount" rendered="#{!shiftChangeController.viewFlag}" />
							<h:outputText value="#{shiftChangeController.outhospAmount}"
								rendered="#{shiftChangeController.viewFlag}"></h:outputText></td>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="inhospAmount">住院老人数量</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:inputText
								style="width: 175px"
								value="#{shiftChangeController.inhospAmount}" id="inhospAmount"
								rendered="#{!shiftChangeController.viewFlag}"></p:inputText> <h:outputText
								value="#{shiftChangeController.inhospAmount}"
								rendered="#{shiftChangeController.viewFlag}"></h:outputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="returnhomeAmount">回家老人数量</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:inputText
								style="width: 175px"
								value="#{shiftChangeController.returnhomeAmount}"
								id="returnhomeAmount"
								rendered="#{!shiftChangeController.viewFlag}" /> <h:outputText
								value="#{shiftChangeController.returnhomeAmount}"
								rendered="#{shiftChangeController.viewFlag}"></h:outputText></td>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="totalAmount">在院老人总数</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:inputText
								style="width: 175px"
								value="#{shiftChangeController.totalAmount}" id="totalAmount"
								rendered="#{!shiftChangeController.viewFlag}"></p:inputText> <h:outputText
								value="#{shiftChangeController.totalAmount}"
								rendered="#{shiftChangeController.viewFlag}"></h:outputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="icuOlder">危重老人</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px">
							<div style="overflow-y: auto; height: 70px">
								<p:inputTextarea width="150px"
									value="#{shiftChangeController.selectShiftChangeRecord.icuOlder}"
									id="icuOlder" maxlength="600"
									rendered="#{!shiftChangeController.viewFlag}" />
								<h:outputText
									value="#{shiftChangeController.selectShiftChangeRecord.icuOlder}"
									rendered="#{shiftChangeController.viewFlag}"></h:outputText>
							</div>
						</td>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="olderSafe">老人安全</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px">
							<div style="overflow-y: auto; height: 70px">
								<p:inputTextarea width="150px"
									value="#{shiftChangeController.selectShiftChangeRecord.olderSafe}"
									id="olderSafe" maxlength="600"
									rendered="#{!shiftChangeController.viewFlag}"></p:inputTextarea>
								<h:outputText
									value="#{shiftChangeController.selectShiftChangeRecord.olderSafe}"
									rendered="#{shiftChangeController.viewFlag}"></h:outputText>
							</div>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="olderHealth">老人卫生</label></td>
						<td class="hengbiaogedata" style="padding: 0px 0px 0px 0px">
							<div style="overflow-y: auto; height: 70px">
								<p:inputTextarea width="150px"
									value="#{shiftChangeController.selectShiftChangeRecord.olderHealth}"
									id="olderHealth" maxlength="600"
									rendered="#{!shiftChangeController.viewFlag}" />
								<h:outputText
									value="#{shiftChangeController.selectShiftChangeRecord.olderHealth}"
									rendered="#{shiftChangeController.viewFlag}"></h:outputText>
							</div>
						</td>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="environmentHealth">环境卫生</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px">
							<div style="overflow-y: auto; height: 70px">
								<p:inputTextarea width="150px"
									value="#{shiftChangeController.selectShiftChangeRecord.environmentHealth}"
									id="environmentHealth" maxlength="600"
									rendered="#{!shiftChangeController.viewFlag}"></p:inputTextarea>
								<h:outputText
									value="#{shiftChangeController.selectShiftChangeRecord.environmentHealth}"
									rendered="#{shiftChangeController.viewFlag}"></h:outputText>
							</div>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="equipmentDetail">设备设施</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px">
							<div style="overflow-y: auto; height: 70px">
								<p:inputTextarea width="150px"
									value="#{shiftChangeController.selectShiftChangeRecord.equipmentDetail}"
									id="equipmentDetail" maxlength="600"
									rendered="#{!shiftChangeController.viewFlag}" />
								<h:outputText
									value="#{shiftChangeController.selectShiftChangeRecord.equipmentDetail}"
									rendered="#{shiftChangeController.viewFlag}"></h:outputText>
							</div>
						</td>
						<td class="hengbiaogeHeader1" width="61px"><label
							class="redfont" for="changeContent">交付物品</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px">
							<div style="overflow-y: auto; height: 70px">
								<p:inputTextarea width="150px"
									value="#{shiftChangeController.selectShiftChangeRecord.changeContent}"
									id="changeContent" maxlength="600"
									rendered="#{!shiftChangeController.viewFlag}" />
								<h:outputText
									value="#{shiftChangeController.selectShiftChangeRecord.changeContent}"
									rendered="#{shiftChangeController.viewFlag}"></h:outputText>
							</div>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="61px"><label
							style="color: red" for="changeTime">交班时间</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:calendar
								showButtonPanel="true" pattern="yyyy-MM-dd HH:mm"
								id="changeTime" style="width: 175px"
								value="#{shiftChangeController.selectShiftChangeRecord.changeTime}"
								rendered="#{!shiftChangeController.viewFlag}" size="26"
								required="true" requiredMessage="请选择交班时间！" /> <h:outputText
								value="#{shiftChangeController.selectShiftChangeRecord.changeTime}"
								rendered="#{shiftChangeController.viewFlag}">
								<f:convertDateTime pattern="yyyy-MM-dd"></f:convertDateTime>
							</h:outputText></td>
						<td class="hengbiaogeHeader1" width="61px"><label for="note">备注</label></td>
						<td class="hengbiaogedata" width="161px"
							style="padding: 0px 0px 0px 0px"><p:inputText
								style="width: 175px"
								value="#{shiftChangeController.selectShiftChangeRecord.note}"
								id="note" maxlength="600"
								rendered="#{!shiftChangeController.viewFlag}"></p:inputText> <h:outputText
								value="#{shiftChangeController.selectShiftChangeRecord.note}"
								rendered="#{shiftChangeController.viewFlag}"></h:outputText></td>
					</tr>
				</table>
				<div align="center">
					<p:commandButton value="保存" styleClass="commonbtn"
						rendered="#{!shiftChangeController.viewFlag}"
						onstart="return checkNulls('modifyForm','redfont',true);"
						action="#{shiftChangeController.saveShiftChangeRecord}"
						oncomplete="afterSaveShiftChangeRecord(xhr,status,args)"
						update=":shiftChangeForm,:messages">
					</p:commandButton>
					<p:commandButton styleClass="commonbtn" value="确认"
						rendered="#{shiftChangeController.selectShiftChangeRecord != null and shiftChangeController.employee.id == shiftChangeController.selectShiftChangeRecord.successorId and shiftChangeController.selectShiftChangeRecord.sended == 1 and shiftChangeController.selectShiftChangeRecord.affirmed == 2}"
						action="#{shiftChangeController.affirmRecord}"
						oncomplete="modifyDig.hide()" update=":shiftChangeForm,:messages"></p:commandButton>
					<p:commandButton styleClass="commonbtn" value="取消"
						action="#{shiftChangeController.abandonSave}"
						oncomplete="modifyDig.hide()" update=":shiftChangeForm,:messages"></p:commandButton>
				</div>
			</h:form>
		</p:dialog>



	</h:body>
	<script type="text/javascript">
		jQuery(document).ready(function() {
			jQuery("#shiftChangeForm\\:affirmBtn").click();
		});
		function afterSaveShiftChangeRecord(xhr, status, args) {
			if (args.validate) {
				modifyDig.hide();
			}
		}
		function afterCheckSelectData(xhr, status, args) {
			if (args.validate) {
				modifyDig.show();
			}
		}
		function afterCheckDeleteData(xhr, status, args) {
			if (args.validate) {
				deleteConfirm.show();
			}
		}
		function afterSaveAutoArranges(xhr, status, args) {
			if (args.validate) {
				autoDig.hide();
			}
		}
		function clearSearchForm() {
			jQuery("#searchForm\\:startDate").val("");
			jQuery("#searchForm\\:endDate").val("");
		}
		function changeme(obj) {
			if (obj.className == "overdiv") {
				obj.className = "overdivscroll";
				obj.title = "点击关闭";
				//nowheightflage=true;
			} else {
				obj.scrollTop = 0;
				obj.className = "overdiv";
				obj.title = "点击查看更多";
				//	nowheightflage=false;
			}
		}
	</script>
</f:view>

</html>