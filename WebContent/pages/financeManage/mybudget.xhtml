<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:his="http://centling.his.net/histag"
	xmlns:p="http://primefaces.org/ui">

<f:view contentType="text/html">
	<h:head>
		<title>#{pageConfig.myBudget}</title>


		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>

		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/common.js?ver=#{projectConfig.ver}" />
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>

	<h:body>
		<p:growl id="messages" widgetVar="message"></p:growl>
		<h:form id="searchForm">
			<h:outputText value="开始日期:" style="text-align:right" />
			<p:calendar id="startDate" pattern="yyyy-MM-dd"
				value="#{myBudgetController.startDate}" />
			<h:outputText value="结束日期:" style="text-align:right" />
			<p:calendar id="endDate" pattern="yyyy-MM-dd"
				value="#{myBudgetController.endDate}" />
			<h:outputText value="审批结果:" style="text-align:right" />
			<h:selectOneMenu
				class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover"
				value="#{myBudgetController.approvalResult}" id="approvalResult">
				<f:selectItem itemLabel="全部" />
				<f:selectItem itemValue="0" itemLabel="正在审批" />
				<f:selectItem itemValue="1" itemLabel="同意" />
				<f:selectItem itemValue="2" itemLabel="不同意" />
			</h:selectOneMenu>
			<p:commandButton styleClass="searchbtn" value="" ajax="true"
				process="@this,startDate,endDate,approvalResult,checkSearchDate"
				action="#{myBudgetController.search}" update=":listForm,:messages">
			</p:commandButton>
			<p:commandButton styleClass="commonbtn" value="清空"
				action="#{myBudgetController.clearSearchForm}"
				update=":searchForm,:messages">
			</p:commandButton>
			<h:inputHidden value="checkSearchDate" id="checkSearchDate"
				validator="#{approveBudgetController.checkSearchDate}" />
		</h:form>

		<h:form id="listForm">
			<p:dataTable id="list" value="#{myBudgetController.financialBudgets}"
				var="financialBudget" rowKey="#{financialBudget.id}"
				emptyMessage="当前无内容" selectionMode="single"
				selection="#{myBudgetController.selectFinancialBudget}" rows="6"
				paginatorAlwaysVisible="false" paginatorPosition="bottom"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
				paginator="true">
				<p:ajax event="rowSelect"
					listener="#{myBudgetController.onFinancialBudgetSelect}"
					update=":messages" />
				<p:ajax event="rowUnselect"
					listener="#{myBudgetController.onFinancialBudgetUnselect}"
					update=":messages" />
				<p:column headerText="预算名称" style="text-align:center">
					<h:outputText value="#{financialBudget.budgetname}" readonly="true"
						style="width:80px;height:20px" />
				</p:column>
				<p:column headerText="#{pageConfig.budgettype}"
					style="text-align:center;width:80px;height:20px">
					<h:outputText value="#{financialBudget.budgetTypeName}" />
				</p:column>
				<p:column headerText="金额" style="text-align:center;width:60px;">
					<h:outputText value="#{financialBudget.money}" style="height:20px" />
				</p:column>
				<p:column headerText="申请日期" style="text-align:center;width:120px;">
					<h:outputText value="#{financialBudget.applytime}" readonly="true"
						style="width:80px;height:20px">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>
				<p:column headerText="审批结果" style="text-align:center;width:100px;">
					<h:outputText value="#{financialBudget.approveResultStr}" />
				</p:column>
				<p:column headerText="审批日期" style="text-align:center;width:120px;">
					<h:outputText value="#{financialBudget.approvetime}"
						readonly="true" style="width:80px;height:20px">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>
				<p:column headerText="发放人"
					style="text-align:center;width:100px;height:20px">
					<h:outputText value="#{financialBudget.givername}" />
				</p:column>
				<p:column headerText="发放日期" style="text-align:center;width:120px;">
					<h:outputText value="#{financialBudget.givetime}" readonly="true"
						style="width:80px;height:20px">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>
			</p:dataTable>
			<div align="center">
				<p:commandButton value="新增" styleClass="commonbtn" ajax="true"
					process="@this" action="#{myBudgetController.add}"
					oncomplete="addDig.show(),onClickAdd()" update=":addForm,:messages">
				</p:commandButton>
				<p:commandButton value="修改" styleClass="commonbtn" ajax="true"
					process="@this,listForm:checkSelectData"
					oncomplete="checkmodifyData(xhr,status,args)"
					update=":addForm,:messages">
				</p:commandButton>
				<p:commandButton value="提交" styleClass="commonbtn" ajax="true"
					process="@this,listForm:checkSendData"
					action="#{myBudgetController.send}" update=":messages">
				</p:commandButton>
				<p:commandButton value="查看" styleClass="commonbtn" ajax="true"
					process="@this,listForm:checkMyData"
					oncomplete="afterCheckMyDate(xhr,status,args)"
					update=":showForm,:messages">
				</p:commandButton>
				<p:commandButton value="删除" styleClass="commonbtn" ajax="true"
					process="@this,listForm:checkSelectData"
					oncomplete="checkdeleteData(xhr,status,args)" update=":messages">
				</p:commandButton>
				<h:inputHidden value="checkSelectData" id="checkSelectData"
					validator="#{myBudgetController.checkSelectData}" />
				<h:inputHidden value="checkMyData" id="checkMyData"
					validator="#{myBudgetController.checkMyData}" />
				<h:inputHidden value="checkSendData" id="checkSendData"
					validator="#{myBudgetController.checkSendData}" />
			</div>
		</h:form>
		<p:confirmDialog message="是否确认删除该预算申请记录？" severity="alert"
			widgetVar="deleteConfirm" appendTo="@(body)">
			<h:form>
				<p:commandButton styleClass="submitbtn" value=""
					style="margin-left:80px;"
					actionListener="#{myBudgetController.delete}"
					update=":listForm,:messages" ajax="true"
					oncomplete="deleteConfirm.hide()" />
				<p:commandButton styleClass="cancelbtn" value=""
					onclick="deleteConfirm.hide()" type="button" />
			</h:form>
		</p:confirmDialog>
		<p:dialog widgetVar="addDig" appendTo="@(body)" resizable="true"
			header="预算申请" modal="true">
			<h:form id="addForm">
				<table style="width: 300px">
					<tr>
						<td class="hengbiaogeHeader1" width="100"><label
							class="redfont" for="budgetname">申请名称:</label></td>
						<td class="hengbiaogedata" width="120"><p:inputText
								value="#{myBudgetController.selectFinancialBudget.budgetname}"
								id="budgetname" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><label
							class="redfont" for="budgettype">部门名称:</label></td>
						<td class="hengbiaogedata" width="120"><h:selectOneMenu
								style="width:150px" id="budgettype"
								value="#{myBudgetController.selectFinancialBudget.budgettype}"
								class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
								<f:selectItems value="#{myBudgetController.budgettypes}"
									var="budgettype" rowKey="#{budgettype.id}"
									itemValue="#{budgettype.id}" itemLabel="#{budgettype.type}" />
							</h:selectOneMenu></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><label
							class="redfont" for="money">申请金额:</label></td>
						<td class="hengbiaogedata" width="120"><p:inputText
								id="money" value="#{myBudgetController.money}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="reason">事由:</label></td>
						<td class="hengbiaogedata" width="120">
							<div style="overflow: auto; height: 107px">
								<p:inputTextarea style="width: 140px" rows="5"
									value="#{myBudgetController.selectFinancialBudget.reason}"
									id="reason" required="true" requiredMessage="请输入申请事由！" />
							</div>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="申请人:" style="text-align:right" /></td>
						<td class="hengbiaogedata" width="120"><p:inputText
								value="#{myBudgetController.selectFinancialBudget.applyername}"
								readonly="true" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="申请时间:" style="text-align:right" /></td>
						<td class="hengbiaogedata" width="120"><p:inputText
								value="#{myBudgetController.selectFinancialBudget.applytime}"
								readonly="true">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</p:inputText></td>
					</tr>
				</table>
				<div align="center">
					<p:commandButton value="提交" styleClass="commonbtn"
						onstart="return checkNulls('addForm','redfont',true);"
						action="#{myBudgetController.saveAndSend}"
						oncomplete="afterSave(xhr,status,args)"
						update=":listForm,:messages"></p:commandButton>
					<p:commandButton value="保存" styleClass="commonbtn"
						onstart="return checkNulls('addForm','redfont',true);"
						action="#{myBudgetController.saveMyFinancialBudget}"
						oncomplete="afterSave(xhr,status,args)"
						update=":listForm,:messages"></p:commandButton>
					<p:commandButton value="关闭" styleClass="commonbtn"
						onclick="addDig.hide()" type="button" update=":listForm,:messages"></p:commandButton>

				</div>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="showDig" appendTo="@(body)" resizable="true"
			header="查看预算申请" modal="true">
			<h:form id="showForm">
				<table style="width: 500px;">
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="申请名称:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.budgetname}"></h:outputText>
						</td>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="#{pageConfig.budgettype}:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.budgetTypeName}"></h:outputText>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="申请金额:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.money}"></h:outputText>

						</td>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="审批结果:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText value="等待审批"
								rendered="#{myBudgetController.selectFinancialBudget.approveresult!=1&amp;&amp;myBudgetController.selectFinancialBudget.approveresult!=2}"></h:outputText>
							<h:outputText value="同意"
								rendered="#{myBudgetController.selectFinancialBudget.approveresult==1}"></h:outputText>
							<h:outputText value="
								不同意"
								rendered="#{myBudgetController.selectFinancialBudget.approveresult==2}"></h:outputText>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="事由:" style="text-align:right" /></td>
						<td class="hengbiaogedata">
							<div style="overflow: auto; height: 150px;">
								<h:outputText
									value="#{myBudgetController.selectFinancialBudget.reason}"></h:outputText>
							</div>
						</td>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="审批意见:" style="text-align:right" /></td>
						<td class="hengbiaogedata">
							<div style="overflow: auto; height: 150px;">
								<h:outputText
									value="#{myBudgetController.selectFinancialBudget.approvenote}"></h:outputText>
							</div>
						</td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="申请时间:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.applytime}">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText></td>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="审批时间:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.approvetime}">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1" width="100"><h:outputText
								value="发放人:" style="text-align:right" /></td>
						<td class="hengbiaogedata"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.givername}"></h:outputText>
						</td>
						<td class="hengbiaogeHeader1"><h:outputText value="发放时间:"
								style="text-align:right" /></td>
						<td class="hengbiaogedata" width="120"><h:outputText
								value="#{myBudgetController.selectFinancialBudget.givetime}">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText></td>
					</tr>
				</table>
				<div align="center">
					<p:commandButton value="关闭" styleClass="commonbtn"
						oncomplete="showDig.hide()" update=":messages"></p:commandButton>
				</div>
			</h:form>
		</p:dialog>

		<script type="text/javascript">
			function afterPay() {
				detailDig.hide();
			}
			function afterCheckMyDate(xhr, status, args) {
				if (args.validate) {
					showDig.show();
				}
			}
			function checkdeleteData(xhr, status, args) {
				if (args.validate) {
					deleteConfirm.show();
				}
			}
			function afterSave(xhr, status, args) {
				if (args.validate) {
					addDig.hide();
				}
			}
			function checkmodifyData(xhr, status, args) {
				if (args.validate) {
					addDig.show();
				}
			}
			function onClickAdd() {
				jQuery("#addForm\\:budgetname").focus();
			}
			function afterAddDetail() {
				jQuery("#addDetailForm\\:projectName").focus();
			}
		</script>


	</h:body>
</f:view>





</html>