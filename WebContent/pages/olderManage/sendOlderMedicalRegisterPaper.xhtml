<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css" ></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	    <script type="text/javascript" src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		 <script type="text/javascript" src="#{request.contextPath}/resources/js/common.js?ver=#{projectConfig.ver}" />
	<script type="text/javascript" src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>
	<h:body>
		<p:growl id="messages"></p:growl>
		<h:form id="headForm">
		<h:panelGrid columns="15">
			<!-- 输入起始时间和截止时间 -->
			<h:outputText value="&nbsp;&nbsp;就医时间:" style="width:80" />
			<p:calendar id="startDate" pattern="yyyy-MM-dd" size="15"
				value="#{sendOlderMedicalRegisterPaperController.startDate}" />
			<h:outputText value="至:" style="width:80" />
			<p:calendar id="endDate" pattern="yyyy-MM-dd" size="15"
				value="#{sendOlderMedicalRegisterPaperController.endDate}" />
			<h:outputLabel value="老人姓名:" for="headForm:nameText"  />
			<h:panelGroup>
				<p:inputText id="nameText" style="width:120px" />
				<his:IME for="headForm:nameText"
					fitcol="inputCode" resultcol="0" lock="true"
					rawSQL="true"
					SQL="#{entryVacationApplicationController.olderNameSql}"
					SQLResult="老人姓名:0,大厦:1,楼层:2,房间:3,床位:4,老人Id:5:hide,输入码:6"
					multiresult="headForm:olderIdHd;5" />
				<h:inputHidden id="olderIdHd" value="#{sendOlderMedicalRegisterPaperController.olderId}" />
			</h:panelGroup>
			<h:outputLabel value="分组负责人:" for="managerNameText" />
			<h:panelGroup>
						<p:inputText id="managerNameText" style="width:120px"/>
						<his:IME for="headForm:managerNameText"
							fitcol="inputCode" resultcol="0" lock="true"
							rawSQL="true"
							SQL="#{medicalRegisterController.groupSql}"
							SQLResult="负责人:0,车牌号:1,出发时间:2,返回时间:3,分组id:4:hide,输入码:6"
							multiresult="headForm:groupIdHd;4" />
						<h:inputHidden id="groupIdHd" value="#{sendOlderMedicalRegisterPaperController.groupId}" />
					</h:panelGroup>
			<p:commandButton id="searchButton"
				action="#{sendOlderMedicalRegisterPaperController.selectOlderMedicalRegisterRecords}"
				styleClass="searchbtn" value=""
				update=":dataTableForm,:maintainForm,:messages" />
			<p:commandButton  oncomplete="clearSelectForm()" styleClass="blankbtn" value="" 
						action="#{sendOlderMedicalRegisterPaperController.clearSelectForm}" update=":headForm"/>
		</h:panelGrid>
	</h:form>
	<h:form id="dataTableForm">
		<h:panelGrid id="medicalRegisterRecord" style="width:100%">
			<p:dataTable cellspacing="8" rows="10" style="width:100%"
				id="medicalRegisterTable" rowIndexVar="row"
				value="#{sendOlderMedicalRegisterPaperController.records}"
				var="record" rowKey="#{record.id}" selectionMode="multiple" emptyMessage="没有相应记录"
				selection="#{sendOlderMedicalRegisterPaperController.selectedRows}"
				paginator="true" paginatorPosition="bottom"
				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
				
				
				
				>
				<p:ajax event="rowSelect" listener="#{sendOlderMedicalRegisterPaperController.selectRecord}" update=":dataTableForm,:maintainForm"/>
				<p:ajax event="rowUnselect" listener="#{sendOlderMedicalRegisterPaperController.unSelectRecord}" update=":dataTableForm,:maintainForm"/>
				<p:column headerText="姓名">
					<h:outputText value="#{record.olderName}" />
				</p:column>
				<p:column headerText="大厦">
					<h:outputText value="#{record.buildName}" />
				</p:column>
				<p:column headerText="房间">
					<h:outputText value="#{record.roomName}" />
				</p:column>
				<p:column headerText="床位">
					<h:outputText value="#{record.bedName}" />
				</p:column>
				<p:column headerText="就医日期">
					<h:outputText value="#{record.hospitalizetime}" >
						<f:convertDateTime pattern="yyyy年MM月dd日" timeZone="GMT+8" />
					</h:outputText>
				</p:column>
				<p:column headerText="就医类型">
					<h:outputText value="#{record.type}" />
				</p:column>
				<p:column headerText="就医事项">
					<h:outputText value="#{record.hospitalizeissue}" />
				</p:column>
				<p:column headerText="预交金">
					<h:outputText value="#{record.advance}" />
				</p:column>
				<p:column headerText="分组负责人">
					<h:outputText value="#{record.managerName}" />
				</p:column>
				<p:column headerText="出发时间">
					<h:outputText value="#{record.leaveTime}" rendered="#{record.leaveTime != null}" >
						<f:convertDateTime pattern="yyyy年MM月dd日" timeZone="GMT+8" />
					</h:outputText>
				</p:column>
				<p:column headerText="是否发送">
					<h:outputText value="已发送" rendered="#{record.sended == 1}" />
					<h:outputText value="未发送" rendered="#{record.sended != 1}" />
				</p:column>
			</p:dataTable>
		</h:panelGrid>
	</h:form>
	<h:form id="maintainForm">
		<div align="center">
			<p:commandButton value="提交" styleClass="commonbtn" 
				action="#{sendOlderMedicalRegisterPaperController.sendOlderMedicalRegisterRecord}"			
				disabled="#{sendOlderMedicalRegisterPaperController.disSendButton}" update=":dataTableForm,:maintainForm,:messages"/>
		</div>
	</h:form>
	<script type="text/javascript">
	
		function handleUpdateComplete(xhr, status, args){
			if(!args.validationFailed) {
				updateRecordDialog.hide();
            }	
            
		}
		//清空 selectForm
		function clearSelectForm(){
			document.getElementById("headForm:startDate").value="";
			document.getElementById("headForm:endDate").value="";
			document.getElementById("headForm:nameText").value="";
			document.getElementById("headForm:managerNameText").value="";
			
			return true;
		}

	</script>
	</h:body>
</f:view>
</html>