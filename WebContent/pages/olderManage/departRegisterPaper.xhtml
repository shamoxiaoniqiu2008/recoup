<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css"></link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
		<h:outputScript library="javax.faces" name="jsf.js" target="head" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/common.js?ver=#{projectConfig.ver}" />
	</h:head>
	<h:body>
		<p:growl id="messages" widgetVar="message"></p:growl>
		<h:form id="headForm">
			<h:panelGrid columns="15">
				<h:inputHidden value="#{departRegisterController.olderId}"
					id="olderId" />
				<h:outputText value="&nbsp;&nbsp;老人姓名" />
				<p:inputText value="#{departRegisterController.olderName}"
					id="olderName" />
				<his:IME for="headForm:olderName" fitcol="oldName,inputCode"
					resultcol="1" lock="true" rawSQL="true"
					SQL="#{departRegisterController.olderNameSql}"
					SQLResult="编号:6:hide,姓名:0,性别:5,大厦:1,楼层:2,房间:3,床位:4"
					multiresult="headForm:olderId;0,headForm:bedName;6" />
				<h:outputText value="&nbsp;&nbsp;预计离院时间:" style="width:80" />
				<p:calendar id="startDate" pattern="yyyy-MM-dd" size="15"
					value="#{departRegisterController.startDate}" />
				<h:outputText value="至:" style="width:80" />
				<p:calendar id="endDate" pattern="yyyy-MM-dd" size="15"
					value="#{departRegisterController.endDate}" />
				<p:commandButton id="searchButton"
					action="#{departRegisterController.search}" styleClass="searchbtn"
					value="" update=":dataTableForm,:maintainForm,:messages" />
				<p:commandButton styleClass="blankbtn" value=""
					action="#{departRegisterController.clearSelectForm}"
					update=":dataTableForm:list,:headForm" />
			</h:panelGrid>
		</h:form>
		<h:form id="dataTableForm">
			<p:dataTable id="list"
				value="#{departRegisterController.pensionDepartregisters}"
				var="pensionDepartregister" rowKey="#{pensionDepartregister.id}"
				emptyMessage="没有相应记录"
				selection="#{departRegisterController.selectPensionDepartregister}"
				selectionMode="single" paginator="true"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
				rows="10" paginatorAlwaysVisible="false" paginatorPosition="bottom">

				<p:ajax event="rowSelect"
					listener="#{departRegisterController.setEnableFlag}"
					update=":maintainForm" />

				<p:ajax event="rowUnselect"
					listener="#{departRegisterController.setUnableFlag}"
					update=":maintainForm" />

				<p:column headerText="合同号">
					<h:outputText value="#{pensionDepartregister.contractNum}" />
				</p:column>
				<p:column headerText="姓名">
					<h:outputText value="#{pensionDepartregister.name}" />
				</p:column>
				<p:column headerText="大厦">
					<h:outputText value="#{pensionDepartregister.building_name}" />
				</p:column>
				<p:column headerText="楼层">
					<h:outputText value="#{pensionDepartregister.floor_name}" />
				</p:column>
				<p:column headerText="房间">
					<h:outputText value="#{pensionDepartregister.room_name}" />
				</p:column>
				<p:column headerText="床位">
					<h:outputText value="#{pensionDepartregister.bed_name}" />
				</p:column>
				<p:column headerText="入住时间">
					<h:outputText value="#{pensionDepartregister.visitTime}">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>
				<p:column headerText="预计离院时间">
					<h:outputText value="#{pensionDepartregister.leavetime}">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>
				<p:column headerText="离院原因">
					<h:outputText value="#{pensionDepartregister.leavereason}" />
				</p:column>
				<p:column headerText="状态">
					<h:outputText value="申请"
						rendered="#{pensionDepartregister.isagree == 1}" />
					<h:outputText value="待审批"
						rendered="#{pensionDepartregister.isagree == 2}" />
					<h:outputText value="审批中"
						rendered="#{pensionDepartregister.isagree == 3}" />
					<h:outputText value="待离院"
						rendered="#{pensionDepartregister.isagree == 5}" />
				</p:column>
			</p:dataTable>
		</h:form>
		<h:form id="maintainForm">
			<div align="center">
				<p:commandButton styleClass="addbtn" value=""
					oncomplete="insertRecordDialog.show()" update=":insertForm" />
				<p:commandButton styleClass="modifybtn" value="" id="modifybtn"
					disabled="#{departRegisterController.disabledFlag}"
					oncomplete="updateRecordDialog.show()" update=":updateForm" />
				<p:commandButton styleClass="deletebtn" value="" id="deletebtn"
					onclick="confirmDelDialog.show()"
					disabled="#{departRegisterController.disabledFlag}" type="button" />
				<p:commandButton id="confirmApplyButton" value="提交"
					onclick="confirmAppDialog.show()" styleClass="commonbtn"
					disabled="#{departRegisterController.disabledFlag}">
				</p:commandButton>
				<p:commandButton id="cancelApplyButton" value="撤销申请"
					onclick="cancelAppDialog.show()" styleClass="commonbtn"
					disabled="#{departRegisterController.disabledFlagForCancel}">
				</p:commandButton>
			</div>
		</h:form>

		<p:dialog header="添加申请" widgetVar="insertRecordDialog"
			resizable="false" appendTo="@(body)" position="top" modal="true">
			<h:form id="insertForm">
				<table class="hengbiaoge" width="100%" align="center">
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="nameText">老人姓名:</label></td>
						<td class="hengbiaogedata"><p:inputText id="nameText"
								style="width:127px"
								value="#{departRegisterController.insertedRow.name}">
							</p:inputText> <his:IME for="insertForm:nameText" fitcol="inputCode,oldName"
								resultcol="1" lock="true" rawSQL="true"
								SQL="#{departRegisterController.olderNameSql}"
								SQLResult="编号:6:hide,姓名:0,性别:5,大厦:1,楼层:3,房间:2,床位:4"
								multiresult="insertForm:buildingText;3,insertForm:floorText;4,insertForm:roomText;5,insertForm:bedNoText;6,insertForm:buildingText_show;3,insertForm:floorText_show;4,insertForm:roomText_show;5,insertForm:bedNoText_show;6,insertForm:olderIdHd;0" />
							<h:inputHidden id="olderIdHd"
								value="#{departRegisterController.insertedRow.olderId}" /> <h:inputHidden
								id="buildingText"
								value="#{departRegisterController.insertedRow.building_name}" />
							<h:inputHidden id="floorText"
								value="#{departRegisterController.insertedRow.floor_name}" /> <h:inputHidden
								id="roomText"
								value="#{departRegisterController.insertedRow.room_name}" /> <h:inputHidden
								id="bedNoText"
								value="#{departRegisterController.insertedRow.bed_name}" /></td>

						<td class="hengbiaogeHeader1"><h:outputLabel value="大厦:"
								for="buildingText" /></td>
						<td class="hengbiaogedata"><p:inputText
								id="buildingText_show" style="width:127px" disabled="true"
								value="#{departRegisterController.insertedRow.building_name}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="楼层:" /></td>
						<td class="hengbiaogedata"><p:inputText id="floorText_show"
								style="width:127px" disabled="true"
								value="#{departRegisterController.insertedRow.floor_name}" /></td>

						<td class="hengbiaogeHeader1"><h:outputLabel value="房间:" /></td>
						<td class="hengbiaogedata"><p:inputText id="roomText_show"
								style="width:127px" disabled="true"
								value="#{departRegisterController.insertedRow.room_name}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="床位号:" /></td>
						<td class="hengbiaogedata"><p:inputText id="bedNoText_show"
								style="width:127px" disabled="true"
								value="#{departRegisterController.insertedRow.bed_name}" /></td>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="leaveDate_input">预计离院时间:</label></td>
						<td class="hengbiaogedata"><p:calendar id="leaveDate"
								pattern="yyyy-MM-dd" size="18"
								value="#{departRegisterController.insertedRow.leavetime}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="reasonText">离院原由:</label></td>
						<td class="hengbiaogedata" colspan="3"><p:inputTextarea
								id="reasonText" autoResize="true" cols="44" rows="2"
								value="#{departRegisterController.insertedRow.leavereason}" /></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton id="saveAndSend" value="提交"
						onstart="return checkNulls('insertForm','redfont',true);"
						action="#{departRegisterController.saveAndSendRegister}"
						styleClass="commonbtn"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						update=":insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton">
					</p:commandButton>
					<p:commandButton styleClass="commonbtn" value="保存"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						action="#{departRegisterController.insertDepartRegisterRecord}"
						onstart="return checkNulls('insertForm','redfont',true);"
						update=" :insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton" />
					<p:commandButton type="reset" styleClass="commonbtn" value="关闭"
						onclick="insertRecordDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<p:dialog header="更新申请" widgetVar="updateRecordDialog"
			focus=":updateForm:reasonText" showEffect="fade" hideEffect="explode"
			resizable="false" appendTo="@(body)" position="center" modal="true">
			<h:form id="updateForm">
				<table class="hengbiaoge" width="100%" id="insertTable">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="老人姓名:" /></td>
						<td class="hengbiaogedata"><h:panelGroup>
								<p:inputText id="nameText" style="width:127px" disabled="true"
									value="#{departRegisterController.selectPensionDepartregister.name}">
								</p:inputText>
								<his:IME for="updateForm:nameText" fitcol="inputCode,oldName"
									resultcol="1" lock="true" rawSQL="true"
									SQL="#{departRegisterController.selectSQL}"
									SQLResult="编号:0:hide,姓名:1,输入码:2:hide,性别:3,大厦:4,楼层:5,房间:6,床位:7"
									multiresult="updateForm:buildingText;3,updateForm:floorText;4,updateForm:roomText;5,updateForm:bedNoText;6,updateForm:buildingText_show;3,updateForm:floorText_show;4,updateForm:roomText_show;5,updateForm:bedNoText_show;6,updateForm:olderIdHd;0" />
								<h:inputHidden id="olderIdHd"
									value="#{departRegisterController.insertedRow.olderId}" />
								<h:inputHidden id="buildingText"
									value="#{departRegisterController.insertedRow.building_name}" />
								<h:inputHidden id="floorText"
									value="#{departRegisterController.insertedRow.floor_name}" />
								<h:inputHidden id="roomText"
									value="#{departRegisterController.insertedRow.room_name}" />
								<h:inputHidden id="bedNoText"
									value="#{departRegisterController.insertedRow.bed_name}" />
							</h:panelGroup></td>
						<td class="hengbiaogeHeader1"><h:outputLabel value="大厦:"
								for="buildingText" /></td>
						<td class="hengbiaogedata"><p:inputText
								id="buildingText_show" style="width:127px" disabled="true"
								value="#{departRegisterController.selectPensionDepartregister.building_name}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="楼层:"
								for="floorText" /></td>
						<td class="hengbiaogedata"><p:inputText id="floorText_show"
								style="width:127px" disabled="true"
								value="#{departRegisterController.selectPensionDepartregister.floor_name}" /></td>
						<td class="hengbiaogeHeader1"><h:outputLabel value="房间:"
								for="roomText" /></td>
						<td class="hengbiaogedata"><p:inputText id="roomText_show"
								style="width:127px" disabled="true"
								value="#{departRegisterController.selectPensionDepartregister.room_name}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><h:outputLabel value="床位号:"
								for="bedNoText" /></td>
						<td class="hengbiaogedata"><p:inputText id="bedNoText_show"
								style="width:127px" disabled="true"
								value="#{departRegisterController.selectPensionDepartregister.bed_name}" /></td>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="leaveDate_input">预计离院时间:</label></td>
						<td class="hengbiaogedata"><p:calendar id="leaveDate"
								pattern="yyyy-MM-dd" size="18"
								value="#{departRegisterController.selectPensionDepartregister.leavetime}" /></td>
					</tr>
					<tr>
						<td class="hengbiaogeHeader1"><label class="redfont"
							for="reasonText">离院原由:</label></td>
						<td class="hengbiaogedata" colspan="3"><p:inputTextarea
								id="reasonText" autoResize="true" cols="44" rows="2"
								value="#{departRegisterController.selectPensionDepartregister.leavereason}" /></td>
					</tr>
				</table>
				<div style="width: 100%; text-align: center;">
					<p:commandButton id="updateAndSend" value="提交"
						onstart="return checkNulls('updateForm','redfont',true);"
						action="#{departRegisterController.updateAndSendRegister}"
						update=":insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton"
						styleClass="commonbtn"
						oncomplete="handleUpdateComplete(xhr, status, args)" />
					<p:commandButton styleClass="commonbtn" value="保存"
						oncomplete="handleUpdateComplete(xhr, status, args)"
						action="#{departRegisterController.updateDepartRegisterRecord}"
						onstart="return checkNulls('updateForm','redfont',true);"
						update=":insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton" />
					<p:commandButton type="reset" styleClass="commonbtn" value="关闭"
						onclick="updateRecordDialog.hide()">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>
		<p:dialog appendTo="@(body)" modal="true"
			header="#{pageConfig.deleteRow}" widgetVar="confirmDelDialog"
			width="220">
			<h:form>
				<h:panelGrid>
					<f:facet name="header">
						<h:outputText value="#{pageConfig.sureDelete}?"
							style="font-weight:bold;" />
					</f:facet>
					<f:facet name="footer">
						<p:commandButton styleClass="submitbtn" value=""
							action="#{departRegisterController.deleteDepartRegisterRecord}"
							update=":insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton"
							oncomplete="confirmDelDialog.hide();">
						</p:commandButton>
						<p:commandButton styleClass="cancelbtn" value="" type="button"
							onclick="confirmDelDialog.hide();"></p:commandButton>
					</f:facet>
				</h:panelGrid>

			</h:form>
		</p:dialog>
		<p:dialog appendTo="@(body)" modal="true" header="发送申请"
			widgetVar="confirmAppDialog" width="220">
			<h:form>
				<h:panelGrid>
					<f:facet name="header">
						<h:outputText value="确认发送离院申请?" style="font-weight:bold;" />
					</f:facet>
					<f:facet name="footer">
						<p:commandButton styleClass="submitbtn" value=""
							actionListener="#{departRegisterController.sendRegister}"
							update=":insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton"
							oncomplete="confirmAppDialog.hide();">
						</p:commandButton>
						<p:commandButton styleClass="cancelbtn" value="" type="button"
							onclick="confirmAppDialog.hide();"></p:commandButton>
					</f:facet>
				</h:panelGrid>

			</h:form>
		</p:dialog>
		<p:dialog appendTo="@(body)" modal="true" header="撤销申请"
			widgetVar="cancelAppDialog" width="220">
			<h:form>
				<h:panelGrid>
					<f:facet name="header">
						<h:outputText value="确认撤销离院申请?" style="font-weight:bold;" />
					</f:facet>
					<f:facet name="footer">
						<p:commandButton styleClass="submitbtn" value=""
							actionListener="#{departRegisterController.cancelSend}"
							update=":insertForm,:dataTableForm,:messages,:maintainForm:modifybtn,:maintainForm:deletebtn,:maintainForm:confirmApplyButton"
							oncomplete="cancelAppDialog.hide();">
						</p:commandButton>
						<p:commandButton styleClass="cancelbtn" value="" type="button"
							onclick="cancelAppDialog.hide();"></p:commandButton>
					</f:facet>
				</h:panelGrid>

			</h:form>
		</p:dialog>

		<script type="text/javascript">
			// 聚焦到项目编号文本框 
			function focusNameText() {
				jQuery("#insertForm\\:nameText").focus();
			}
			function handleUpdateComplete(xhr, status, args) {
				if (args.add) {
					insertRecordDialog.hide();
					updateRecordDialog.hide();
				}

			}
			/**
			 * 时间对象的格式化;
			 */
			Date.prototype.format = function(format) {
				/*
				 * eg:format="YYYY-MM-dd hh:mm:ss";
				 */
				var o = {
					"M+" : this.getMonth() + 1, // month
					"d+" : this.getDate(), // day
					"h+" : this.getHours(), // hour
					"m+" : this.getMinutes(), // minute
					"s+" : this.getSeconds(), // second
					"q+" : Math.floor((this.getMonth() + 3) / 3), // quarter
					"S" : this.getMilliseconds()
				// millisecond
				}

				if (/(y+)/.test(format)) {
					format = format.replace(RegExp.$1,
							(this.getFullYear() + "")
									.substr(4 - RegExp.$1.length));
				}

				for ( var k in o) {
					if (new RegExp("(" + k + ")").test(format)) {
						format = format.replace(RegExp.$1,
								RegExp.$1.length == 1 ? o[k] : ("00" + o[k])
										.substr(("" + o[k]).length));
					}
				}
				return format;
			}
			function checkDate(id) {
				inputDate = document.getElementById(id).value;
				now = new Date();
				var nowStr = now.format("yyyy-MM-dd");
				if (inputDate == null || inputDate == '' || inputDate == "") {
					alert("离院日期不能为空！");
					return false;
				}
				if (nowStr > inputDate) {
					alert("离院日期必须大于当前日期！");
					return false;
				} else {
					return true;
				}

			}
		</script>
	</h:body>
</f:view>
</html>