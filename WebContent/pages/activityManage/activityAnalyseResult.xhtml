<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag" style="width:100%">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html" style="width:100%">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css">
		</link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		</meta>
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>
	<p:growl id="msg"></p:growl>
	<h:form id="analyseForm">
		<h:outputText value="活动项目:"></h:outputText>
		<p:inputText id="itemSignInput"
			value="#{activityAnalyseController.itemName}"></p:inputText>
		<his:IME for="analyseForm:itemSignInput"
			fitcol="#{activityAnalyseController.fitcolItem}" resultcol="1"
			lock="false" rawSQL="true"
			SQL="#{activityAnalyseController.itemToSql}"
			SQLResult="#{activityAnalyseController.displaycolItem}"
			multiresult="analyseForm:itemSignInputHidden;0,analyseForm:itemSignInput;1" />
		<h:inputHidden id="itemSignInputHidden"
			value="#{activityAnalyseController.itemId}"></h:inputHidden>
		<h:outputText value="报名时间:"></h:outputText>
		<p:calendar size="17" id="calStartDate"
			value="#{activityAnalyseController.startDate}"
			pattern="yyyy-MM-dd HH:mm"></p:calendar>
		<h:outputText value="至"></h:outputText>
		<p:calendar size="17" id="calEndDate"
			value="#{activityAnalyseController.endDate}"
			pattern="yyyy-MM-dd HH:mm"></p:calendar>
		<h:outputText value="质检结果:"></h:outputText>
		<h:selectOneMenu value="#{activityAnalyseController.appraise}"
			id="appraise"
			class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
			<f:selectItem itemLabel="全部"></f:selectItem>
			<f:selectItem itemValue="1" itemLabel="满意"></f:selectItem>
			<f:selectItem itemValue="2" itemLabel="不满意"></f:selectItem>
		</h:selectOneMenu>
		<p:commandButton styleClass="searchbtn" value="" ajax="true"
			process="@this,itemSignInput,itemSignInputHidden,calStartDate,calEndDate,appraise"
			action="#{activityAnalyseController.searchSumRecord}"
			update=":msg,:analyseForm:sumTable,:analyseForm:signTable"></p:commandButton>
		<p:commandButton styleClass="blankbtn" value="" ajax="true"
			process="@this" action="#{activityAnalyseController.initParam}"
			update=":analyseForm"></p:commandButton>
		<p:dataTable id="sumTable" emptyMessage="没有找到记录！"
			value="#{activityAnalyseController.extendForActivityAnalyseList}"
			var="extendList" rowKey="#{extendList.activityId}"
			selectionMode="single"
			selection="#{activityAnalyseController.selectedExtendForActivityAnalyse}"
			onRowSelectupdate=":analyseForm:signTable" paginator="true"
			paginatorPosition="bottom" rows="5" paginatorAlwaysVisible="false"
			paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
			<p:ajax event="rowSelect"
				listener="#{activityAnalyseController.setSelectedFlag}"
				update=":analyseForm" />
			<p:ajax event="rowUnselect"
				listener="#{activityAnalyseController.setUnselectedFlag}"
				update=":analyseForm" />
			<p:column headerText="活动项目" styleClass="width60">
				<h:outputText value="#{extendList.activityName}"></h:outputText>
			</p:column>
			<p:column headerText="举办时间" styleClass="width60">
				<h:outputText value="#{extendList.startDate}">
					<f:convertDateTime pattern="yyyy-MM-dd HH:mm"></f:convertDateTime>
				</h:outputText>
			</p:column>
			<p:column headerText="举办地点" styleClass="width60">
				<h:outputText value="#{extendList.itemplace}"></h:outputText>
			</p:column>
			<p:column headerText="报名人数" styleClass="width60">
				<h:outputText value="#{extendList.activityerQty}"></h:outputText>
			</p:column>
			<p:column headerText="参加人数" styleClass="width60">
				<h:outputText value="#{extendList.attendNum}"></h:outputText>
			</p:column>
			<p:column headerText="不满意人数" styleClass="width70">
				<h:outputText value="#{extendList.unLikeNum}"></h:outputText>
			</p:column>
			<p:column headerText="质检结果" styleClass="width60">
				<h:outputText value="满意" rendered="#{extendList.summary == 1}"></h:outputText>
				<h:outputText value="不满意" rendered="#{extendList.summary == 2}"></h:outputText>
			</p:column>
			<p:column headerText="质检人" styleClass="width50">
				<h:outputText value="#{extendList.summaryName}"></h:outputText>
			</p:column>
			<p:column headerText="质检时间" styleClass="width60">
				<h:outputText value="#{extendList.summaryDate}">
					<f:convertDateTime pattern="yyyy-MM-dd HH:mm"></f:convertDateTime>
				</h:outputText>
			</p:column>
			<p:column headerText="备注" styleClass="width50">
				<h:outputText value="#{extendList.summaryNote}"></h:outputText>
			</p:column>
		</p:dataTable>
		<p:watermark value="调用输入法" for="itemSignInput"></p:watermark>
		<p:watermark value="起始时间" for="calStartDate"></p:watermark>
		<p:watermark value="截止时间" for="calEndDate"></p:watermark>
		<p:dataTable id="signTable" emptyMessage="没有找到记录！"
			style="margin-top:20px;" paginatorAlwaysVisible="false"
			value="#{activityAnalyseController.pensionAttendolderList}"
			var="detailList" rowKey="#{detailList.id}" paginator="true"
			selection="#{activityAnalyseController.selectAttendolderList}"
			paginatorPosition="bottom" rows="5"
			paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
			<p:column headerText="老人姓名">
				<h:outputText value="#{detailList.olderName}"></h:outputText>
			</p:column>
			<p:column headerText="报名时间">
				<h:outputText value="#{detailList.enlisttime}">
					<f:convertDateTime pattern="yyyy-MM-dd HH:mm"></f:convertDateTime>
				</h:outputText>
			</p:column>
			<p:column headerText="是否参加">
				<h:outputText value="#{detailList.addIsOrNotName}"></h:outputText>
			</p:column>
			<p:column headerText="事由">
				<h:outputText value="#{detailList.reason}"></h:outputText>
			</p:column>
			<p:column headerText="评价">
				<h:outputText value="#{detailList.likeStr}"></h:outputText>
			</p:column>
		</p:dataTable>
		<h:outputText value="&nbsp;"></h:outputText>
	</h:form>
	<p:dialog appendTo="@(body)" header="质检备注" modal="true"
		position="center" widgetVar="checkDialog" height="100" width="300">
		<h:form id="checkForm">
			<table>
				<tr>
					<td class="hengbiaogeHeader1"><h:outputText value="质检备注"></h:outputText>
					</td>
					<td class="hengbiaogedata"><p:inputTextarea
							value="#{activityAnalyseController.activity.summaryNote}"
							id="editInputCodeTxt"></p:inputTextarea></td>
				</tr>
			</table>
			<div align="center">
				<p:commandButton value="" styleClass="submitbtn"
					action="#{activityAnalyseController.saveActivityAnalyse}"
					oncomplete="checkDialog.hide()" update=":analyseForm,:msg" />
				<p:commandButton value="" styleClass="cancelbtn"
					onclick="checkDialog.hide()" update=":analyseForm,:msg" />
			</div>
		</h:form>
	</p:dialog>
	<script type="text/javascript">
		function analyse(xhr, status, args) {
			if (args.validate) {
				checkDialog.show();
			}
		}
	</script>
</f:view>
</html>