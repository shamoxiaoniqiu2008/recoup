<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:his="http://centling.his.net/histag" style="width:100%">

<!-- 回车键，往下！引入的js文件 -->
<f:view contentType="text/html" style="width:100%">
	<h:head>
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/default.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/skin.css" />
		<link type="text/css" rel="stylesheet"
			href="#{request.contextPath}/css/layout.css"></link>
		<link href="#{request.contextPath}/css/css.css" rel="stylesheet"
			type="text/css" />
		<link rel="stylesheet" href="#{request.contextPath}/css/style.css">
		</link>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		</meta>
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/ime.js?ver=#{projectConfig.ver}" />
		<script type="text/javascript"
			src="#{request.contextPath}/resources/js/calendar.js?ver=#{projectConfig.ver}" />
	</h:head>
	<body>
		<p:growl id="msg"></p:growl>
		<h:form id="showForm">
			<h:outputText value="活动项目:"></h:outputText>
			<p:inputText id="itemNameInputText" size="12"
				value="#{applyComfirmController.itemName}"></p:inputText>
			<his:IME for="showForm:itemNameInputText"
				fitcol="#{applyComfirmController.fitcolItem}" resultcol="1"
				lock="false" rawSQL="true" SQL="#{applyComfirmController.itemToSql}"
				SQLResult="#{applyComfirmController.displaycolItem}"
				multiresult="showForm:itemNameInputTextHidden;0,showForm:itemNameInputText;1" />
			<h:inputHidden id="itemNameInputTextHidden"
				value="#{applyComfirmController.itemId}"></h:inputHidden>
			<h:outputText value="老人姓名:"></h:outputText>
			<p:inputText id="olderNameInputText" size="12"
				value="#{applyComfirmController.olderName}"></p:inputText>
			<his:IME for="showForm:olderNameInputText"
				fitcol="#{applyComfirmController.fitcolName}" resultcol="1"
				lock="false" rawSQL="true" SQL="#{applyComfirmController.nameToSql}"
				SQLResult="#{applyComfirmController.displaycolName}"
				multiresult="showForm:olderNameInputTextHidden;0,showForm:olderNameInputText;1" />
			<h:inputHidden id="olderNameInputTextHidden"
				value="#{applyComfirmController.olderId}"></h:inputHidden>
			<h:outputText value="报名时间:"></h:outputText>
			<p:calendar id="applyStartDate" pattern="yyyy-MM-dd HH:mm" size="17"
				value="#{applyComfirmController.startDate}"></p:calendar>
			<h:outputText value="至"></h:outputText>
			<p:calendar id="applyEndDate" pattern="yyyy-MM-dd HH:mm" size="17"
				value="#{applyComfirmController.endDate}"></p:calendar>
			<h:outputText value="是否签到:"></h:outputText>
			<h:selectOneMenu value="#{applyComfirmController.attended}"
				id="isOrNotMenu"
				class="ui-inputfield ui-widget ui-state-default ui-corner-all hasDatepicker ui-state-hover">
				<f:selectItem itemLabel="全部"></f:selectItem>
				<f:selectItem itemValue="2" itemLabel="否"></f:selectItem>
				<f:selectItem itemValue="1" itemLabel="是"></f:selectItem>
			</h:selectOneMenu>
			<p:commandButton styleClass="searchbtn" value=""
				action="#{applyComfirmController.searchAttendInfo}"
				update=":msg,:showForm:showTable"></p:commandButton>
			<p:commandButton styleClass="blankbtn" value=""
				action="#{applyComfirmController.initParam}" update=":showForm"></p:commandButton>
			<p:dataTable id="showTable" emptyMessage="没有找到合适记录！"
				value="#{applyComfirmController.pensionAttendolderList}"
				widgetVar="attendList" var="attendList" rowKey="#{attendList.id}"
				paginator="true" paginatorPosition="bottom" rows="8"
				paginatorAlwaysVisible="false"
				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
				<p:column headerText="老人姓名" width="80">
					<h:outputText value="#{attendList.olderName}"></h:outputText>
				</p:column>
				<p:column headerText="项目名称" width="100">
					<h:outputText value="#{attendList.itemName}"></h:outputText>
				</p:column>
				<p:column headerText="报名时间" width="120">
					<h:outputText value="#{attendList.enlisttime}">
						<f:convertDateTime pattern="yyyy-MM-dd HH:mm"></f:convertDateTime>
					</h:outputText>
				</p:column>
				<p:column headerText="已签到" width="60">
					<h:outputText value="是" rendered="#{attendList.attended==1}"></h:outputText>
					<h:outputText value="否" rendered="#{attendList.attended==2}"></h:outputText>
				</p:column>
				<p:column headerText="事由" width="100">
					<h:outputText value="#{attendList.reason}"></h:outputText>
				</p:column>
				<p:column headerText="操作" width="30">
					<p:commandButton id="confirmButtonColumn" value="已到"
						styleClass="commonbtn"
						actionListener="#{applyComfirmController.saveConfirmInfo(attendList)}"
						update=":showForm:showTable,:msg"></p:commandButton>
					<p:commandButton value="未到" styleClass="commonbtn"
						oncomplete="unSignDialogShow(xhr,status,args)"
						actionListener="#{applyComfirmController.initNote(attendList)}"
						update=":unSignForm,:msg"></p:commandButton>
				</p:column>
			</p:dataTable>
			<p:watermark value="调用输入法" for="itemNameInputText"></p:watermark>
			<p:watermark value="调用输入法" for="olderNameInputText"></p:watermark>
			<p:watermark value="开始时间" for="applyStartDate"></p:watermark>
			<p:watermark value="截止时间" for="applyEndDate"></p:watermark>
			<h:outputText value="&nbsp;"></h:outputText>
		</h:form>

		<p:dialog appendToBody="true" modal="true" header="事由"
			widgetVar="unSignDialog">
			<h:form id="unSignForm">
				<table class="hengbiaoge" width="430px" align="center">
					<tr>
						<td class="hengbiaogeHeader1"><h:outputText value="事由:"
								styleClass="redfont" /></td>
						<td class="hengbiaogedata"><p:inputTextarea required="true"
								requiredMessage="事由不可为空！" autoResize="true" cols="40" rows="3"
								value="#{applyComfirmController.selectedRecord.reason}"></p:inputTextarea>
						</td>
					</tr>
				</table>
				<h:panelGrid id="buttonGrid" columns="2" style="margin:0px auto">
					<p:commandButton process="@this,unSignForm"
						actionListener="#{applyComfirmController.unSignConfirm}"
						oncomplete="unSignDialogHide(xhr,status,args)"
						styleClass="commonbtn" value="保存" update=":showForm,:msg">
					</p:commandButton>
					<p:commandButton onclick="unSignDialog.hide()" type="button"
						styleClass="commonbtn" value="关闭" />
				</h:panelGrid>
			</h:form>
		</p:dialog>





		<script type="text/javascript">
			function handleAttendRequest(xhr, status, args) {
				if (args.showFlag) {
					okDialog.show();
				}
			}

			function unSignDialogHide(xhr, status, args) {
				if (args.hide) {
					unSignDialog.hide();
				}
			}

			function unSignDialogShow(xhr, status, args) {
				if (args.show) {
					unSignDialog.show();
				}
			}
		</script>
	</body>
</f:view>
</html>