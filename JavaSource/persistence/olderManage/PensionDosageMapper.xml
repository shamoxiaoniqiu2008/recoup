<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="persistence.olderManage.PensionDosageMapper">
	<resultMap id="BaseResultMap" type="domain.olderManage.PensionDosage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="isSend" jdbcType="INTEGER" property="issend" />
		<result column="sendTime" jdbcType="TIMESTAMP" property="sendtime" />
		<result column="sender_name" jdbcType="VARCHAR" property="senderName" />
		<result column="sender_id" jdbcType="INTEGER" property="senderId" />
		<result column="notes" jdbcType="VARCHAR" property="notes" />
		<result column="deliveryId" jdbcType="INTEGER" property="deliveryId" />
		<result column="charterId" jdbcType="INTEGER" property="charterid" />
		<result column="charterName" jdbcType="VARCHAR" property="chartername" />
		<result column="deliveryName" jdbcType="VARCHAR" property="deliveryname" />
		<result column="cleared" jdbcType="INTEGER" property="cleared" />
		<result column="nurseDeptId" jdbcType="INTEGER" property="nursedeptid" />
		<result column="nurseDeptName" jdbcType="VARCHAR" property="nursedeptname" />
	</resultMap>
	<sql id="Example_Where_Clause">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		<where>
			<foreach collection="oredCriteria" item="criteria" separator="or">
				<if test="criteria.valid">
					<trim prefix="(" prefixOverrides="and" suffix=")">
						<foreach collection="criteria.criteria" item="criterion">
							<choose>
								<when test="criterion.noValue">
									and ${criterion.condition}
								</when>
								<when test="criterion.singleValue">
									and ${criterion.condition} #{criterion.value}
								</when>
								<when test="criterion.betweenValue">
									and ${criterion.condition} #{criterion.value}
									and
									#{criterion.secondValue}
								</when>
								<when test="criterion.listValue">
									and ${criterion.condition}
									<foreach close=")" collection="criterion.value" item="listItem"
										open="(" separator=",">
										#{listItem}
									</foreach>
								</when>
							</choose>
						</foreach>
					</trim>
				</if>
			</foreach>
		</where>
	</sql>
	<sql id="Update_By_Example_Where_Clause">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		<where>
			<foreach collection="example.oredCriteria" item="criteria"
				separator="or">
				<if test="criteria.valid">
					<trim prefix="(" prefixOverrides="and" suffix=")">
						<foreach collection="criteria.criteria" item="criterion">
							<choose>
								<when test="criterion.noValue">
									and ${criterion.condition}
								</when>
								<when test="criterion.singleValue">
									and ${criterion.condition} #{criterion.value}
								</when>
								<when test="criterion.betweenValue">
									and ${criterion.condition} #{criterion.value}
									and
									#{criterion.secondValue}
								</when>
								<when test="criterion.listValue">
									and ${criterion.condition}
									<foreach close=")" collection="criterion.value" item="listItem"
										open="(" separator=",">
										#{listItem}
									</foreach>
								</when>
							</choose>
						</foreach>
					</trim>
				</if>
			</foreach>
		</where>
	</sql>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		id, isSend, sendTime, sender_name, sender_id, notes, deliveryId,
		charterId, charterName,
		deliveryName, cleared, nurseDeptId,
		nurseDeptName
	</sql>
	<select id="selectByExample" parameterType="domain.olderManage.PensionDosageExample"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		select
		<if test="distinct">
			distinct
		</if>
		<include refid="Base_Column_List" />
		from pension_dosage
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
		<if test="orderByClause != null">
			order by ${orderByClause}
		</if>
	</select>
	<select id="selectByPrimaryKey" parameterType="java.lang.Long"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		select
		<include refid="Base_Column_List" />
		from pension_dosage
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		delete from pension_dosage
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<delete id="deleteByExample" parameterType="domain.olderManage.PensionDosageExample">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		delete from pension_dosage
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
	</delete>
	<insert id="insert" parameterType="domain.olderManage.PensionDosage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		insert into pension_dosage (id, isSend, sendTime,
		sender_name,
		sender_id, notes,
		deliveryId, charterId, charterName,
		deliveryName,
		cleared, nurseDeptId,
		nurseDeptName)
		values (#{id,jdbcType=INTEGER},
		#{issend,jdbcType=INTEGER},
		#{sendtime,jdbcType=TIMESTAMP},
		#{senderName,jdbcType=VARCHAR}, #{senderId,jdbcType=INTEGER},
		#{notes,jdbcType=VARCHAR},
		#{deliveryId,jdbcType=INTEGER},
		#{charterid,jdbcType=INTEGER},
		#{chartername,jdbcType=VARCHAR},
		#{deliveryname,jdbcType=VARCHAR}, #{cleared,jdbcType=INTEGER},
		#{nursedeptid,jdbcType=INTEGER},
		#{nursedeptname,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" keyProperty="id"
		parameterType="domain.olderManage.PensionDosage" useGeneratedKeys="true">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		insert into pension_dosage
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="issend != null">
				isSend,
			</if>
			<if test="sendtime != null">
				sendTime,
			</if>
			<if test="senderName != null">
				sender_name,
			</if>
			<if test="senderId != null">
				sender_id,
			</if>
			<if test="notes != null">
				notes,
			</if>
			<if test="deliveryId != null">
				deliveryId,
			</if>
			<if test="charterid != null">
				charterId,
			</if>
			<if test="chartername != null">
				charterName,
			</if>
			<if test="deliveryname != null">
				deliveryName,
			</if>
			<if test="cleared != null">
				cleared,
			</if>
			<if test="nursedeptid != null">
				nurseDeptId,
			</if>
			<if test="nursedeptname != null">
				nurseDeptName,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="issend != null">
				#{issend,jdbcType=INTEGER},
			</if>
			<if test="sendtime != null">
				#{sendtime,jdbcType=TIMESTAMP},
			</if>
			<if test="senderName != null">
				#{senderName,jdbcType=VARCHAR},
			</if>
			<if test="senderId != null">
				#{senderId,jdbcType=INTEGER},
			</if>
			<if test="notes != null">
				#{notes,jdbcType=VARCHAR},
			</if>
			<if test="deliveryId != null">
				#{deliveryId,jdbcType=INTEGER},
			</if>
			<if test="charterid != null">
				#{charterid,jdbcType=INTEGER},
			</if>
			<if test="chartername != null">
				#{chartername,jdbcType=VARCHAR},
			</if>
			<if test="deliveryname != null">
				#{deliveryname,jdbcType=VARCHAR},
			</if>
			<if test="cleared != null">
				#{cleared,jdbcType=INTEGER},
			</if>
			<if test="nursedeptid != null">
				#{nursedeptid,jdbcType=INTEGER},
			</if>
			<if test="nursedeptname != null">
				#{nursedeptname,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<select id="countByExample" parameterType="domain.olderManage.PensionDosageExample"
		resultType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		select count(*) from pension_dosage
		<if test="_parameter != null">
			<include refid="Example_Where_Clause" />
		</if>
	</select>
	<update id="updateByExampleSelective" parameterType="map">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		update pension_dosage
		<set>
			<if test="record.id != null">
				id = #{record.id,jdbcType=INTEGER},
			</if>
			<if test="record.issend != null">
				isSend = #{record.issend,jdbcType=INTEGER},
			</if>
			<if test="record.sendtime != null">
				sendTime = #{record.sendtime,jdbcType=TIMESTAMP},
			</if>
			<if test="record.senderName != null">
				sender_name = #{record.senderName,jdbcType=VARCHAR},
			</if>
			<if test="record.senderId != null">
				sender_id = #{record.senderId,jdbcType=INTEGER},
			</if>
			<if test="record.notes != null">
				notes = #{record.notes,jdbcType=VARCHAR},
			</if>
			<if test="record.deliveryId != null">
				deliveryId = #{record.deliveryId,jdbcType=INTEGER},
			</if>
			<if test="record.charterid != null">
				charterId = #{record.charterid,jdbcType=INTEGER},
			</if>
			<if test="record.chartername != null">
				charterName = #{record.chartername,jdbcType=VARCHAR},
			</if>
			<if test="record.deliveryname != null">
				deliveryName = #{record.deliveryname,jdbcType=VARCHAR},
			</if>
			<if test="record.cleared != null">
				cleared = #{record.cleared,jdbcType=INTEGER},
			</if>
			<if test="record.nursedeptid != null">
				nurseDeptId = #{record.nursedeptid,jdbcType=INTEGER},
			</if>
			<if test="record.nursedeptname != null">
				nurseDeptName = #{record.nursedeptname,jdbcType=VARCHAR},
			</if>
		</set>
		<if test="_parameter != null">
			<include refid="Update_By_Example_Where_Clause" />
		</if>
	</update>
	<update id="updateByExample" parameterType="map">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		update pension_dosage
		set id = #{record.id,jdbcType=INTEGER},
		isSend =
		#{record.issend,jdbcType=INTEGER},
		sendTime =
		#{record.sendtime,jdbcType=TIMESTAMP},
		sender_name =
		#{record.senderName,jdbcType=VARCHAR},
		sender_id =
		#{record.senderId,jdbcType=INTEGER},
		notes =
		#{record.notes,jdbcType=VARCHAR},
		deliveryId =
		#{record.deliveryId,jdbcType=INTEGER},
		charterId =
		#{record.charterid,jdbcType=INTEGER},
		charterName =
		#{record.chartername,jdbcType=VARCHAR},
		deliveryName =
		#{record.deliveryname,jdbcType=VARCHAR},
		cleared =
		#{record.cleared,jdbcType=INTEGER},
		nurseDeptId =
		#{record.nursedeptid,jdbcType=INTEGER},
		nurseDeptName =
		#{record.nursedeptname,jdbcType=VARCHAR}
		<if test="_parameter != null">
			<include refid="Update_By_Example_Where_Clause" />
		</if>
	</update>
	<update id="updateByPrimaryKeySelective" parameterType="domain.olderManage.PensionDosage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		update pension_dosage
		<set>
			<if test="issend != null">
				isSend = #{issend,jdbcType=INTEGER},
			</if>
			<if test="sendtime != null">
				sendTime = #{sendtime,jdbcType=TIMESTAMP},
			</if>
			<if test="senderName != null">
				sender_name = #{senderName,jdbcType=VARCHAR},
			</if>
			<if test="senderId != null">
				sender_id = #{senderId,jdbcType=INTEGER},
			</if>
			<if test="notes != null">
				notes = #{notes,jdbcType=VARCHAR},
			</if>
			<if test="deliveryId != null">
				deliveryId = #{deliveryId,jdbcType=INTEGER},
			</if>
			<if test="charterid != null">
				charterId = #{charterid,jdbcType=INTEGER},
			</if>
			<if test="chartername != null">
				charterName = #{chartername,jdbcType=VARCHAR},
			</if>
			<if test="deliveryname != null">
				deliveryName = #{deliveryname,jdbcType=VARCHAR},
			</if>
			<if test="cleared != null">
				cleared = #{cleared,jdbcType=INTEGER},
			</if>
			<if test="nursedeptid != null">
				nurseDeptId = #{nursedeptid,jdbcType=INTEGER},
			</if>
			<if test="nursedeptname != null">
				nurseDeptName = #{nursedeptname,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="domain.olderManage.PensionDosage">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Nov 21 
			13:43:52 CST 2013. -->
		update pension_dosage
		set isSend = #{issend,jdbcType=INTEGER},
		sendTime
		= #{sendtime,jdbcType=TIMESTAMP},
		sender_name =
		#{senderName,jdbcType=VARCHAR},
		sender_id =
		#{senderId,jdbcType=INTEGER},
		notes = #{notes,jdbcType=VARCHAR},
		deliveryId = #{deliveryId,jdbcType=INTEGER},
		charterId =
		#{charterid,jdbcType=INTEGER},
		charterName =
		#{chartername,jdbcType=VARCHAR},
		deliveryName =
		#{deliveryname,jdbcType=VARCHAR},
		cleared =
		#{cleared,jdbcType=INTEGER},
		nurseDeptId =
		#{nursedeptid,jdbcType=INTEGER},
		nurseDeptName =
		#{nursedeptname,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>



	<!-- 按条件查询药单主记录 add by mary 2013-11-21 -->
	<select id="selectDosages" parameterType="java.util.Map"
		resultMap="BaseResultMap">
		select *
		from pension_dosage pd
		where 1=1
		<if test="startDate != null">
			and unix_timestamp(pd.sendTime)
			&gt;=unix_timestamp(#{startDate})
		</if>
		<if test="endDate != null">
			and unix_timestamp(date_add(#{endDate}, interval 1 day))
			&gt;=unix_timestamp(pd.sendTime)
		</if>

		<if test=" sendFlag != null">
			and pd.isSend = #{sendFlag,jdbcType=INTEGER}
		</if>
		<if test=" senderId != null">
			and pd.sender_id = #{senderId,jdbcType=INTEGER}
		</if>
		<if test=" chargerId != null">
			and pd.charterId = #{chargerId,jdbcType=INTEGER}
			and
			pd.isSend = 1
		</if>
		and pd.cleared = 2 order by pd.sendTime DESC

	</select>

	<!-- 按条件查询审核未通过的药单主记录 add by mary 2013-11-21 -->
	<select id="selectUnPassDosages" parameterType="java.util.Map"
		resultMap="BaseResultMap">
		select distinct pd.*
		from pension_dosage pd,
		pension_dosagedetail p
		where
		pd.id=p.dosage_id
		and p.isCheck=1
		and p.checkResult=2
		<if test="startDate != null">
			and unix_timestamp(pd.sendTime)
			&gt;=unix_timestamp(#{startDate})
		</if>
		<if test="endDate != null">
			and unix_timestamp(date_add(#{endDate}, interval 1 day))
			&gt;=unix_timestamp(pd.sendTime)
		</if>

		<if test=" senderId != null">
			and pd.sender_id = #{senderId,jdbcType=INTEGER}
		</if>
		<if test=" chargerId != null">
			and pd.charterId = #{chargerId,jdbcType=INTEGER}
			and
			pd.isSend = 1
		</if>
		and pd.cleared = 2 order by pd.sendTime DESC

	</select>

	<select id="selectEnsureDosages" parameterType="map"
		resultType="domain.olderManage.PensionDosagedetail">
		select
		pd.id,
		pd.older_id,
		pd.older_name as olderName,
		pd.eatTime as
		eattime,
		pd.dept_name as deptName,
		pd.drug_name as drugName,
		pd.single_dose as
		singleDose,
		pd.unit,
		pd.period,
		pd.checkResult as
		checkresult,
		pd.isCheck
		as ischeck,
		pd.isEatFood as iseatfood,
		p.charterName as charterName,
		p.deliveryName as deliverName,
		pd.isEnsure as isensure
		from
		pension_dosagedetail pd,
		pension_dosage p
		where p.id=pd.dosage_id
		and
		pd.checkResult=1
		<if test="startDate != null">
			and unix_timestamp(pd.eatTime)
			&gt;=unix_timestamp(#{startDate})
		</if>
		<if test="endDate != null">
			and unix_timestamp(date_add(#{endDate}, interval 1 day))
			&gt;unix_timestamp(pd.eatTime)
		</if>
		<if test="ensureFlag != null&amp;&amp; ensureFlag != ''">
			and pd.isEnsure=#{ensureFlag}
		</if>
		<if test=" chargerId != null">
			and p.charterId = #{chargerId,jdbcType=INTEGER}
		</if>
		order by pd.eatTime,pd.older_id asc
	</select>


</mapper>