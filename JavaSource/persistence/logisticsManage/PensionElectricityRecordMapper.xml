<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="persistence.logisticsManage.PensionElectricityRecordMapper">
  <resultMap id="BaseResultMap" type="domain.logisticsManage.PensionElectricityRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="degrees_number" jdbcType="REAL" property="degreesNumber" />
    <result column="lately_flag" jdbcType="INTEGER" property="latelyFlag" />
    <result column="ammeter_id" jdbcType="INTEGER" property="ammeterId" />
    <result column="inputuser_id" jdbcType="INTEGER" property="inputuserId" />
    <result column="input_time" jdbcType="TIMESTAMP" property="inputTime" />
    <result column="cleared" jdbcType="INTEGER" property="cleared" />
    <result column="note" jdbcType="VARCHAR" property="note" />
    <result column="last_degrees_number" jdbcType="REAL" property="lastDegreesNumber" />
    <result column="last_input_time" jdbcType="TIMESTAMP" property="lastInputTime" />
    <result column="ensure_flag" jdbcType="INTEGER" property="ensureFlag" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    id, degrees_number, lately_flag, ammeter_id, inputuser_id, input_time, cleared, note, 
    last_degrees_number, last_input_time, ensure_flag
  </sql>
  <select id="selectByExample" parameterType="domain.logisticsManage.PensionElectricityRecordExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from pension_electricity_record
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    from pension_electricity_record
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    delete from pension_electricity_record
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="domain.logisticsManage.PensionElectricityRecordExample">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    delete from pension_electricity_record
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="domain.logisticsManage.PensionElectricityRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    insert into pension_electricity_record (id, degrees_number, lately_flag, 
      ammeter_id, inputuser_id, input_time, 
      cleared, note, last_degrees_number, 
      last_input_time, ensure_flag)
    values (#{id,jdbcType=INTEGER}, #{degreesNumber,jdbcType=REAL}, #{latelyFlag,jdbcType=INTEGER}, 
      #{ammeterId,jdbcType=INTEGER}, #{inputuserId,jdbcType=INTEGER}, #{inputTime,jdbcType=TIMESTAMP}, 
      #{cleared,jdbcType=INTEGER}, #{note,jdbcType=VARCHAR}, #{lastDegreesNumber,jdbcType=REAL}, 
      #{lastInputTime,jdbcType=TIMESTAMP}, #{ensureFlag,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" keyProperty="id" parameterType="domain.logisticsManage.PensionElectricityRecord" useGeneratedKeys="true">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    insert into pension_electricity_record
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="degreesNumber != null">
        degrees_number,
      </if>
      <if test="latelyFlag != null">
        lately_flag,
      </if>
      <if test="ammeterId != null">
        ammeter_id,
      </if>
      <if test="inputuserId != null">
        inputuser_id,
      </if>
      <if test="inputTime != null">
        input_time,
      </if>
      <if test="cleared != null">
        cleared,
      </if>
      <if test="note != null">
        note,
      </if>
      <if test="lastDegreesNumber != null">
        last_degrees_number,
      </if>
      <if test="lastInputTime != null">
        last_input_time,
      </if>
      <if test="ensureFlag != null">
        ensure_flag,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="degreesNumber != null">
        #{degreesNumber,jdbcType=REAL},
      </if>
      <if test="latelyFlag != null">
        #{latelyFlag,jdbcType=INTEGER},
      </if>
      <if test="ammeterId != null">
        #{ammeterId,jdbcType=INTEGER},
      </if>
      <if test="inputuserId != null">
        #{inputuserId,jdbcType=INTEGER},
      </if>
      <if test="inputTime != null">
        #{inputTime,jdbcType=TIMESTAMP},
      </if>
      <if test="cleared != null">
        #{cleared,jdbcType=INTEGER},
      </if>
      <if test="note != null">
        #{note,jdbcType=VARCHAR},
      </if>
      <if test="lastDegreesNumber != null">
        #{lastDegreesNumber,jdbcType=REAL},
      </if>
      <if test="lastInputTime != null">
        #{lastInputTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ensureFlag != null">
        #{ensureFlag,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="domain.logisticsManage.PensionElectricityRecordExample" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    select count(*) from pension_electricity_record
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    update pension_electricity_record
    <set>
      <if test="record.id != null">
        id = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.degreesNumber != null">
        degrees_number = #{record.degreesNumber,jdbcType=REAL},
      </if>
      <if test="record.latelyFlag != null">
        lately_flag = #{record.latelyFlag,jdbcType=INTEGER},
      </if>
      <if test="record.ammeterId != null">
        ammeter_id = #{record.ammeterId,jdbcType=INTEGER},
      </if>
      <if test="record.inputuserId != null">
        inputuser_id = #{record.inputuserId,jdbcType=INTEGER},
      </if>
      <if test="record.inputTime != null">
        input_time = #{record.inputTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.cleared != null">
        cleared = #{record.cleared,jdbcType=INTEGER},
      </if>
      <if test="record.note != null">
        note = #{record.note,jdbcType=VARCHAR},
      </if>
      <if test="record.lastDegreesNumber != null">
        last_degrees_number = #{record.lastDegreesNumber,jdbcType=REAL},
      </if>
      <if test="record.lastInputTime != null">
        last_input_time = #{record.lastInputTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.ensureFlag != null">
        ensure_flag = #{record.ensureFlag,jdbcType=INTEGER},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    update pension_electricity_record
    set id = #{record.id,jdbcType=INTEGER},
      degrees_number = #{record.degreesNumber,jdbcType=REAL},
      lately_flag = #{record.latelyFlag,jdbcType=INTEGER},
      ammeter_id = #{record.ammeterId,jdbcType=INTEGER},
      inputuser_id = #{record.inputuserId,jdbcType=INTEGER},
      input_time = #{record.inputTime,jdbcType=TIMESTAMP},
      cleared = #{record.cleared,jdbcType=INTEGER},
      note = #{record.note,jdbcType=VARCHAR},
      last_degrees_number = #{record.lastDegreesNumber,jdbcType=REAL},
      last_input_time = #{record.lastInputTime,jdbcType=TIMESTAMP},
      ensure_flag = #{record.ensureFlag,jdbcType=INTEGER}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="domain.logisticsManage.PensionElectricityRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    update pension_electricity_record
    <set>
      <if test="degreesNumber != null">
        degrees_number = #{degreesNumber,jdbcType=REAL},
      </if>
      <if test="latelyFlag != null">
        lately_flag = #{latelyFlag,jdbcType=INTEGER},
      </if>
      <if test="ammeterId != null">
        ammeter_id = #{ammeterId,jdbcType=INTEGER},
      </if>
      <if test="inputuserId != null">
        inputuser_id = #{inputuserId,jdbcType=INTEGER},
      </if>
      <if test="inputTime != null">
        input_time = #{inputTime,jdbcType=TIMESTAMP},
      </if>
      <if test="cleared != null">
        cleared = #{cleared,jdbcType=INTEGER},
      </if>
      <if test="note != null">
        note = #{note,jdbcType=VARCHAR},
      </if>
      <if test="lastDegreesNumber != null">
        last_degrees_number = #{lastDegreesNumber,jdbcType=REAL},
      </if>
      <if test="lastInputTime != null">
        last_input_time = #{lastInputTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ensureFlag != null">
        ensure_flag = #{ensureFlag,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="domain.logisticsManage.PensionElectricityRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 06 14:36:03 CST 2013.
    -->
    update pension_electricity_record
    set degrees_number = #{degreesNumber,jdbcType=REAL},
      lately_flag = #{latelyFlag,jdbcType=INTEGER},
      ammeter_id = #{ammeterId,jdbcType=INTEGER},
      inputuser_id = #{inputuserId,jdbcType=INTEGER},
      input_time = #{inputTime,jdbcType=TIMESTAMP},
      cleared = #{cleared,jdbcType=INTEGER},
      note = #{note,jdbcType=VARCHAR},
      last_degrees_number = #{lastDegreesNumber,jdbcType=REAL},
      last_input_time = #{lastInputTime,jdbcType=TIMESTAMP},
      ensure_flag = #{ensureFlag,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <!-- add by justin.su 2013-12-09 -->
  <select id="selectElectricityRecordRecords" parameterType="map" resultType="domain.logisticsManage.PensionElectricityRecord">
	select 
	    per.degrees_number as degreesNumber,
		per.last_degrees_number as lastDegreesNumber,
	    pa.id as ammeterId,
	    pa.ammeter_name as ammeterName,
	    pr.id as roomId,
	    pr.name as roomName,
	    pf.name as floorName,
	    pb.name as buildName,
	    per.inputuser_id as inputuserId,
	    pe.name as inputuserName,
	    per.input_time as inputTime,
		case when per.last_input_time is null then 'NULL' else  per.last_input_time end as lastInputTime,
		per.ensure_flag as ensureFlag,
		case per.ensure_flag when 1 then '是' when 2 then '否' else '未知' end as ensureFlagName,
	    per.cleared as cleared,
	    per.id as id,
	    per.note as note
	from
	    pension_room pr
	left join
	    pension_ammeter pa ON pr.id = pa.room_id
	inner join
	    pension_electricity_record per ON per.ammeter_id = pa.id
	inner join
	    pension_floor pf ON pr.floor_id = pf.id
	inner  join
	    pension_building pb ON pf.build_id = pb.id
	 inner join
	    pension_employee pe ON per.inputuser_id = pe.id
	where
	    pr.cleared = 2
	 and
	 	pa.cleared = 2
	and
		pf.cleared = 2
	 and
	 	per.cleared = 2
	 and
	 	pb.cleared = 2
	 and
	 	pe.cleared = 2
	<if test="inputStartTime != null">
		and unix_timestamp(per.input_time)
			&gt;= unix_timestamp(#{inputStartTime})
	</if>
	<if test="inputEndTime != null">
		and unix_timestamp(per.input_time)
			&lt;= unix_timestamp(#{inputEndTime})
	</if>
	<if test="paidFlag!= null ">
	 	  and per.ensure_flag = #{paidFlag,jdbcType=INTEGER}
	 </if>
	<if test="ammeterId != null ">
	 	  and per.ammeter_id = #{ammeterId,jdbcType=INTEGER}
	 </if>
	 <if test="roomId != null ">
	 	  and pr.id = #{roomId,jdbcType=INTEGER}
	 </if>
	 <if test="floorId != null ">
	 	  and pf.id = #{floorId,jdbcType=INTEGER}
	 </if>
	 <if test="buildId != null ">
	 	  and pb.id = #{buildId,jdbcType=INTEGER}
	 </if>
	 order by buildName asc, floorName asc, roomName asc,inputTime desc
  </select>
  
</mapper>